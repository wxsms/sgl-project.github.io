
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>SGLang Model Gateway &#8212; SGLang</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom_log.css?v=731335ad" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom_log.css?v=731335ad" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=226d1e48"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=ccdb6887"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'advanced_features/sgl_model_gateway';</script>
    <link rel="icon" href="../_static/logo.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Deterministic Inference" href="deterministic_inference.html" />
    <link rel="prev" title="Cuda Graph for Multi-Modal Encoder in SGLang" href="cuda_graph_for_multi_modal_encoder.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
    <meta name="docbuild:last-update" content="Jan 23, 2026"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="SGLang - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="SGLang - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Get Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../get_started/install.html">Install SGLang</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Basic Usage</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../basic_usage/send_request.html">Sending Requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic_usage/openai_api.html">OpenAI-Compatible APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic_usage/ollama_api.html">Ollama-Compatible API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic_usage/offline_engine_api.html">Offline Engine API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic_usage/native_api.html">SGLang Native APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic_usage/sampling_params.html">Sampling Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic_usage/popular_model_usage.html">Popular Model Usage (DeepSeek, GPT-OSS, GLM, Llama, MiniMax, Qwen, and more)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Advanced Features</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="server_arguments.html">Server Arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="hyperparameter_tuning.html">Hyperparameter Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="attention_backend.html">Attention Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="speculative_decoding.html">Speculative Decoding</a></li>
<li class="toctree-l1"><a class="reference internal" href="structured_outputs.html">Structured Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="structured_outputs_for_reasoning_models.html">Structured Outputs For Reasoning Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="tool_parser.html">Tool Parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="separate_reasoning.html">Reasoning Parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="quantization.html">Quantization</a></li>
<li class="toctree-l1"><a class="reference internal" href="quantized_kv_cache.html">Quantized KV Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="expert_parallelism.html">Expert Parallelism</a></li>
<li class="toctree-l1"><a class="reference internal" href="lora.html">LoRA Serving</a></li>
<li class="toctree-l1"><a class="reference internal" href="pd_disaggregation.html">PD Disaggregation</a></li>
<li class="toctree-l1"><a class="reference internal" href="epd_disaggregation.html">EPD Disaggregation</a></li>
<li class="toctree-l1"><a class="reference internal" href="pipeline_parallelism.html">Pipeline Parallelism for Long Context</a></li>
<li class="toctree-l1"><a class="reference internal" href="hicache.html">Hierarchical KV Caching (HiCache)</a></li>
<li class="toctree-l1"><a class="reference internal" href="vlm_query.html">Query VLM with Offline Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="dp_for_multi_modal_encoder.html">DP for Multi-Modal Encoder in SGLang</a></li>
<li class="toctree-l1"><a class="reference internal" href="cuda_graph_for_multi_modal_encoder.html">Cuda Graph for Multi-Modal Encoder in SGLang</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">SGLang Model Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="deterministic_inference.html">Deterministic Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="observability.html">Observability</a></li>
<li class="toctree-l1"><a class="reference internal" href="checkpoint_engine.html">Checkpoint Engine Integration</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Supported Models</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../supported_models/generative_models.html">Large Language Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../supported_models/multimodal_language_models.html">Multimodal Language Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../supported_models/diffusion_language_models.html">Diffusion Language Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../supported_models/diffusion_models.html">Diffusion Models</a></li>










<li class="toctree-l1"><a class="reference internal" href="../supported_models/embedding_models.html">Embedding Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../supported_models/reward_models.html">Reward Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../supported_models/rerank_models.html">Rerank Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../supported_models/classify_models.html">Classification API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../supported_models/support_new_models.html">How to Support New Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../supported_models/transformers_fallback.html">Transformers fallback in SGLang</a></li>
<li class="toctree-l1"><a class="reference internal" href="../supported_models/modelscope.html">Use Models From ModelScope</a></li>
<li class="toctree-l1"><a class="reference internal" href="../supported_models/mindspore_models.html">MindSpore Models</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Hardware Platforms</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../platforms/amd_gpu.html">AMD GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/cpu_server.html">CPU Servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/tpu.html">TPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/nvidia_jetson.html">NVIDIA Jetson Orin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/ascend_npu_support.html">Ascend NPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/xpu.html">XPU</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/contribution_guide.html">Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/development_guide_using_docker.html">Development Guide Using Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/benchmark_and_profiling.html">Benchmark and Profiling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/bench_serving.html">Bench Serving Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/evaluating_new_models.html">Evaluating New Models with SGLang</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">References</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../references/faq.html">Troubleshooting and Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/environment_variables.html">Environment Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/production_metrics.html">Production Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/production_request_trace.html">Production Request Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/multi_node_deployment/multi_node_index.html">Multi-Node Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/custom_chat_template.html">Custom Chat Template</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/frontend/frontend_index.html">Frontend Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/post_training_integration.html">Post-Training Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/learn_more.html">Learn More and Join the Community</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/sgl-project/sgl-project.github.io" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/sgl-project/sgl-project.github.io/blob/main/advanced_features/sgl_model_gateway.md?plain=1" target="_blank"
   class="btn btn-sm btn-source-file-button dropdown-item"
   title="Show source"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="btn__text-container">Show source</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/sgl-project/sgl-project.github.io/edit/main/advanced_features/sgl_model_gateway.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/sgl-project/sgl-project.github.io/issues/new?title=Issue%20on%20page%20%2Fadvanced_features/sgl_model_gateway.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/advanced_features/sgl_model_gateway.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>SGLang Model Gateway</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#architecture">Architecture</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#control-plane">Control Plane</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-plane">Data Plane</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#storage-and-privacy">Storage and Privacy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation">Installation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#docker">Docker</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">Prerequisites</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rust-binary">Rust Binary</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#python-package">Python Package</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quick-start">Quick Start</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regular-http-routing">Regular HTTP Routing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grpc-routing">gRPC Routing</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#deployment-modes">Deployment Modes</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#co-launch-router-and-workers">Co-launch Router and Workers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#separate-launch-http">Separate Launch (HTTP)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grpc-launch">gRPC Launch</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prefill-decode-disaggregation">Prefill-Decode Disaggregation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#openai-backend-proxy">OpenAI Backend Proxy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-model-inference-gateway">Multi-Model Inference Gateway</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#api-reference">API Reference</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inference-endpoints">Inference Endpoints</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tokenization-endpoints">Tokenization Endpoints</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#tokenize-request">Tokenize Request</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#batch-tokenize-request">Batch Tokenize Request</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#tokenize-response">Tokenize Response</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#detokenize-request">Detokenize Request</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#detokenize-response">Detokenize Response</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#add-tokenizer-async">Add Tokenizer (Async)</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parser-endpoints">Parser Endpoints</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#separate-reasoning-request">Separate Reasoning Request</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#response">Response</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#function-call-parsing">Function Call Parsing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#classification-api">Classification API</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#request">Request</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Response</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#response-fields">Response Fields</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#notes">Notes</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conversation-and-response-apis">Conversation and Response APIs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#worker-management-apis">Worker Management APIs</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#add-worker">Add Worker</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#list-workers">List Workers</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#admin-and-health-endpoints">Admin and Health Endpoints</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-balancing-policies">Load Balancing Policies</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cache-aware-policy-tuning">Cache-Aware Policy Tuning</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reliability-and-flow-control">Reliability and Flow Control</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#retries">Retries</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#circuit-breaker">Circuit Breaker</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rate-limiting-and-queuing">Rate Limiting and Queuing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#health-checks">Health Checks</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reasoning-parser-integration">Reasoning Parser Integration</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#supported-parsers">Supported Parsers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#usage">Usage</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tool-call-parsing">Tool Call Parsing</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#supported-formats">Supported Formats</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Usage</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tokenizer-management">Tokenizer Management</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tokenizer-sources">Tokenizer Sources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration">Configuration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tokenizer-caching">Tokenizer Caching</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mcp-integration">MCP Integration</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#supported-transports">Supported Transports</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Configuration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mcp-configuration-file">MCP Configuration File</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#service-discovery-kubernetes">Service Discovery (Kubernetes)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pd-mode-discovery">PD Mode Discovery</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#history-and-data-connectors">History and Data Connectors</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#oracle-configuration">Oracle Configuration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#postgresql-configuration">PostgreSQL Configuration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#redis-configuration">Redis Configuration</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#wasm-middleware">WASM Middleware</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Overview</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#examples">Examples</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#building-modules">Building Modules</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deploying-modules">Deploying Modules</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#runtime-configuration">Runtime Configuration</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#language-bindings">Language Bindings</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#python-bindings">Python Bindings</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Installation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Usage</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#go-bindings">Go Bindings</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Architecture</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Installation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Examples</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison">Comparison</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#security-and-authentication">Security and Authentication</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#router-api-key">Router API Key</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#worker-api-keys">Worker API Keys</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#security-configurations">Security Configurations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tls-https-for-gateway-server">TLS (HTTPS) for Gateway Server</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mtls-for-worker-communication">mTLS for Worker Communication</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#full-tls-configuration-example">Full TLS Configuration Example</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#observability">Observability</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prometheus-metrics">Prometheus Metrics</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metric-categories-40-metrics">Metric Categories (40+ metrics)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#key-inference-metrics-grpc-mode">Key Inference Metrics (gRPC mode)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#duration-buckets">Duration Buckets</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#opentelemetry-tracing">OpenTelemetry Tracing</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#features">Features</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#logging">Logging</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#request-id-propagation">Request ID Propagation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#production-recommendations">Production Recommendations</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#security-best-practices">Security Best Practices</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#high-availability">High Availability</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#performance">Performance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kubernetes-deployment">Kubernetes Deployment</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#monitoring-with-promql">Monitoring with PromQL</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-reference">Configuration Reference</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#core-settings">Core Settings</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prefill-decode">Prefill/Decode</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kubernetes-discovery">Kubernetes Discovery</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tls-configuration">TLS Configuration</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#troubleshooting">Troubleshooting</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#workers-never-ready">Workers Never Ready</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-imbalance-hot-workers">Load Imbalance / Hot Workers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#circuit-breaker-flapping">Circuit Breaker Flapping</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#queue-overflow-429">Queue Overflow (429)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#memory-growth">Memory Growth</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#debugging">Debugging</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grpc-connection-issues">gRPC Connection Issues</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tokenizer-loading-failures">Tokenizer Loading Failures</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="sglang-model-gateway">
<h1>SGLang Model Gateway<a class="headerlink" href="#sglang-model-gateway" title="Link to this heading">#</a></h1>
<p>SGLang Model Gateway is a high-performance model-routing gateway for large-scale LLM deployments. It centralizes worker lifecycle management, balances traffic across heterogeneous protocols (HTTP, gRPC, OpenAI-compatible), and provides enterprise-ready control over history storage, MCP tooling, and privacy-sensitive workflows. The gateway is deeply optimized for the SGLang serving runtime, but can route to any OpenAI-compatible backend.</p>
<hr class="docutils" />
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#overview"><span class="std std-ref">Overview</span></a></p></li>
<li><p><a class="reference internal" href="#architecture"><span class="std std-ref">Architecture</span></a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#control-plane"><span class="std std-ref">Control Plane</span></a></p></li>
<li><p><a class="reference internal" href="#data-plane"><span class="std std-ref">Data Plane</span></a></p></li>
<li><p><a class="reference internal" href="#storage-and-privacy"><span class="std std-ref">Storage and Privacy</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#installation"><span class="std std-ref">Installation</span></a></p></li>
<li><p><a class="reference internal" href="#quick-start"><span class="std std-ref">Quick Start</span></a></p></li>
<li><p><a class="reference internal" href="#deployment-modes"><span class="std std-ref">Deployment Modes</span></a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#co-launch-router-and-workers"><span class="std std-ref">Co-launch Router and Workers</span></a></p></li>
<li><p><a class="reference internal" href="#separate-launch-http"><span class="std std-ref">Separate Launch (HTTP)</span></a></p></li>
<li><p><a class="reference internal" href="#grpc-launch"><span class="std std-ref">gRPC Launch</span></a></p></li>
<li><p><a class="reference internal" href="#prefill-decode-disaggregation"><span class="std std-ref">Prefill-Decode Disaggregation</span></a></p></li>
<li><p><a class="reference internal" href="#openai-backend-proxy"><span class="std std-ref">OpenAI Backend Proxy</span></a></p></li>
<li><p><a class="reference internal" href="#multi-model-inference-gateway"><span class="std std-ref">Multi-Model Inference Gateway</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#api-reference"><span class="std std-ref">API Reference</span></a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#inference-endpoints"><span class="std std-ref">Inference Endpoints</span></a></p></li>
<li><p><a class="reference internal" href="#tokenization-endpoints"><span class="std std-ref">Tokenization Endpoints</span></a></p></li>
<li><p><a class="reference internal" href="#parser-endpoints"><span class="std std-ref">Parser Endpoints</span></a></p></li>
<li><p><a class="reference internal" href="#classification-api"><span class="std std-ref">Classification API</span></a></p></li>
<li><p><a class="reference internal" href="#conversation-and-response-apis"><span class="std std-ref">Conversation and Response APIs</span></a></p></li>
<li><p><a class="reference internal" href="#worker-management-apis"><span class="std std-ref">Worker Management APIs</span></a></p></li>
<li><p><a class="reference internal" href="#admin-and-health-endpoints"><span class="std std-ref">Admin and Health Endpoints</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#load-balancing-policies"><span class="std std-ref">Load Balancing Policies</span></a></p></li>
<li><p><a class="reference internal" href="#reliability-and-flow-control"><span class="std std-ref">Reliability and Flow Control</span></a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#retries"><span class="std std-ref">Retries</span></a></p></li>
<li><p><a class="reference internal" href="#circuit-breaker"><span class="std std-ref">Circuit Breaker</span></a></p></li>
<li><p><a class="reference internal" href="#rate-limiting-and-queuing"><span class="std std-ref">Rate Limiting and Queuing</span></a></p></li>
<li><p><a class="reference internal" href="#health-checks"><span class="std std-ref">Health Checks</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#reasoning-parser-integration"><span class="std std-ref">Reasoning Parser Integration</span></a></p></li>
<li><p><a class="reference internal" href="#tool-call-parsing"><span class="std std-ref">Tool Call Parsing</span></a></p></li>
<li><p><a class="reference internal" href="#tokenizer-management"><span class="std std-ref">Tokenizer Management</span></a></p></li>
<li><p><a class="reference internal" href="#mcp-integration"><span class="std std-ref">MCP Integration</span></a></p></li>
<li><p><a class="reference internal" href="#service-discovery-kubernetes"><span class="std std-ref">Service Discovery (Kubernetes)</span></a></p></li>
<li><p><a class="reference internal" href="#history-and-data-connectors"><span class="std std-ref">History and Data Connectors</span></a></p></li>
<li><p><a class="reference internal" href="#wasm-middleware"><span class="std std-ref">WASM Middleware</span></a></p></li>
<li><p><a class="reference internal" href="#language-bindings"><span class="std std-ref">Language Bindings</span></a></p></li>
<li><p><a class="reference internal" href="#security-and-authentication"><span class="std std-ref">Security and Authentication</span></a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#tls-https-for-gateway-server"><span class="std std-ref">TLS (HTTPS) for Gateway Server</span></a></p></li>
<li><p><a class="reference internal" href="#mtls-for-worker-communication"><span class="std std-ref">mTLS for Worker Communication</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#observability"><span class="std std-ref">Observability</span></a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#prometheus-metrics"><span class="std std-ref">Prometheus Metrics</span></a></p></li>
<li><p><a class="reference internal" href="#opentelemetry-tracing"><span class="std std-ref">OpenTelemetry Tracing</span></a></p></li>
<li><p><a class="reference internal" href="#logging"><span class="std std-ref">Logging</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#production-recommendations"><span class="std std-ref">Production Recommendations</span></a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#security-best-practices"><span class="std std-ref">Security Best Practices</span></a></p></li>
<li><p><a class="reference internal" href="#high-availability"><span class="std std-ref">High Availability</span></a></p></li>
<li><p><a class="reference internal" href="#performance"><span class="std std-ref">Performance</span></a></p></li>
<li><p><a class="reference internal" href="#kubernetes-deployment"><span class="std std-ref">Kubernetes Deployment</span></a></p></li>
<li><p><a class="reference internal" href="#monitoring-with-promql"><span class="std std-ref">Monitoring with PromQL</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#configuration-reference"><span class="std std-ref">Configuration Reference</span></a></p></li>
<li><p><a class="reference internal" href="#troubleshooting"><span class="std std-ref">Troubleshooting</span></a></p></li>
</ol>
</section>
<hr class="docutils" />
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Unified control plane</strong> for registering, monitoring, and orchestrating regular, prefill, and decode workers across heterogeneous model fleets.</p></li>
<li><p><strong>Multi-protocol data plane</strong> that routes traffic across HTTP, PD (prefill/decode), gRPC, and OpenAI-compatible backends with shared reliability primitives.</p></li>
<li><p><strong>Industry-first gRPC pipeline</strong> with native Rust tokenization, reasoning parsers, and tool-call execution for high-throughput, OpenAI-compatible serving; supports both single-stage and PD topologies.</p></li>
<li><p><strong>Inference Gateway Mode (<code class="docutils literal notranslate"><span class="pre">--enable-igw</span></code>)</strong> dynamically instantiates multiple router stacks (HTTP regular/PD, gRPC) and applies per-model policies for multi-tenant deployments.</p></li>
<li><p><strong>Conversation &amp; responses connectors</strong> centralize chat history inside the router so the same context can be reused across models and MCP loops without leaking data to upstream vendors (memory, none, Oracle ATP, PostgreSQL).</p></li>
<li><p><strong>Enterprise privacy</strong>: agentic multi-turn <code class="docutils literal notranslate"><span class="pre">/v1/responses</span></code>, native MCP client (STDIO/HTTP/SSE/Streamable), and history storage all operate within the router boundary.</p></li>
<li><p><strong>Reliability core</strong>: retries with jitter, worker-scoped circuit breakers, token-bucket rate limiting with queuing, background health checks, and cache-aware load monitoring.</p></li>
<li><p><strong>Comprehensive observability</strong>: 40+ Prometheus metrics, OpenTelemetry distributed tracing, structured logging, and request ID propagation.</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Link to this heading">#</a></h2>
<section id="control-plane">
<h3>Control Plane<a class="headerlink" href="#control-plane" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Worker Manager</strong> discovers capabilities (<code class="docutils literal notranslate"><span class="pre">/get_server_info</span></code>, <code class="docutils literal notranslate"><span class="pre">/get_model_info</span></code>), tracks load, and registers/removes workers in the shared registry.</p></li>
<li><p><strong>Job Queue</strong> serializes add/remove requests and exposes status (<code class="docutils literal notranslate"><span class="pre">/workers/{worker_id}</span></code>) so clients can track onboarding progress.</p></li>
<li><p><strong>Load Monitor</strong> feeds cache-aware and power-of-two policies with live worker load statistics.</p></li>
<li><p><strong>Health Checker</strong> continuously probes workers and updates readiness, circuit breaker state, and router metrics.</p></li>
<li><p><strong>Tokenizer Registry</strong> manages dynamically registered tokenizers with async loading from HuggingFace or local paths.</p></li>
</ul>
</section>
<section id="data-plane">
<h3>Data Plane<a class="headerlink" href="#data-plane" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>HTTP routers</strong> (regular &amp; PD) implement <code class="docutils literal notranslate"><span class="pre">/generate</span></code>, <code class="docutils literal notranslate"><span class="pre">/v1/chat/completions</span></code>, <code class="docutils literal notranslate"><span class="pre">/v1/completions</span></code>, <code class="docutils literal notranslate"><span class="pre">/v1/responses</span></code>, <code class="docutils literal notranslate"><span class="pre">/v1/embeddings</span></code>, <code class="docutils literal notranslate"><span class="pre">/v1/rerank</span></code>, <code class="docutils literal notranslate"><span class="pre">/v1/classify</span></code>, <code class="docutils literal notranslate"><span class="pre">/v1/tokenize</span></code>, <code class="docutils literal notranslate"><span class="pre">/v1/detokenize</span></code>, and associated admin endpoints.</p></li>
<li><p><strong>gRPC router</strong> streams tokenized requests directly to SRT gRPC workers, running fully in Rusttokenizer, reasoning parser, and tool parser all reside in-process. Supports both single-stage and PD routing, including embeddings and classification.</p></li>
<li><p><strong>OpenAI router</strong> proxies OpenAI-compatible endpoints to external vendors (OpenAI, xAI, etc.) while keeping chat history and multi-turn orchestration local.</p></li>
</ul>
</section>
<section id="storage-and-privacy">
<h3>Storage and Privacy<a class="headerlink" href="#storage-and-privacy" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Conversation and response history is stored at the router tier (memory, none, Oracle ATP, or PostgreSQL). The same history can power multiple models or MCP loops without sending data to upstream vendors.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/v1/responses</span></code> agentic flows, MCP sessions, and conversation APIs share the same storage layer, enabling compliance for regulated workloads.</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading">#</a></h2>
<section id="docker">
<h3>Docker<a class="headerlink" href="#docker" title="Link to this heading">#</a></h3>
<p>Pre-built Docker images are available on Docker Hub with multi-architecture support (x86_64 and ARM64):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>pull<span class="w"> </span>lmsysorg/sgl-model-gateway:latest
</pre></div>
</div>
</section>
<section id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading">#</a></h3>
<ul>
<li><p><strong>Rust and Cargo</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>--proto<span class="w"> </span><span class="s1">&#39;=https&#39;</span><span class="w"> </span>--tlsv1.2<span class="w"> </span>-sSf<span class="w"> </span>https://sh.rustup.rs<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh
<span class="nb">source</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.cargo/env&quot;</span>
rustc<span class="w"> </span>--version
cargo<span class="w"> </span>--version
</pre></div>
</div>
</li>
<li><p><strong>Python</strong> with <code class="docutils literal notranslate"><span class="pre">pip</span></code> and virtualenv tooling available.</p></li>
</ul>
</section>
<section id="rust-binary">
<h3>Rust Binary<a class="headerlink" href="#rust-binary" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>sgl-model-gateway
cargo<span class="w"> </span>build<span class="w"> </span>--release
</pre></div>
</div>
</section>
<section id="python-package">
<h3>Python Package<a class="headerlink" href="#python-package" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>maturin

<span class="c1"># Fast development mode</span>
<span class="nb">cd</span><span class="w"> </span>sgl-model-gateway/bindings/python
maturin<span class="w"> </span>develop

<span class="c1"># Production build</span>
maturin<span class="w"> </span>build<span class="w"> </span>--release<span class="w"> </span>--out<span class="w"> </span>dist<span class="w"> </span>--features<span class="w"> </span>vendored-openssl
pip<span class="w"> </span>install<span class="w"> </span>--force-reinstall<span class="w"> </span>dist/*.whl
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="quick-start">
<h2>Quick Start<a class="headerlink" href="#quick-start" title="Link to this heading">#</a></h2>
<section id="regular-http-routing">
<h3>Regular HTTP Routing<a class="headerlink" href="#regular-http-routing" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Rust binary</span>
./target/release/sgl-model-gateway<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-urls<span class="w"> </span>http://worker1:8000<span class="w"> </span>http://worker2:8000<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--policy<span class="w"> </span>cache_aware

<span class="c1"># Python launcher</span>
python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-urls<span class="w"> </span>http://worker1:8000<span class="w"> </span>http://worker2:8000<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--policy<span class="w"> </span>cache_aware
</pre></div>
</div>
</section>
<section id="grpc-routing">
<h3>gRPC Routing<a class="headerlink" href="#grpc-routing" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-urls<span class="w"> </span>grpc://127.0.0.1:20000<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--model-path<span class="w"> </span>meta-llama/Llama-3.1-8B-Instruct<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--reasoning-parser<span class="w"> </span>deepseek-r1<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--tool-call-parser<span class="w"> </span>json<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--host<span class="w"> </span><span class="m">0</span>.0.0.0<span class="w"> </span>--port<span class="w"> </span><span class="m">8080</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="deployment-modes">
<h2>Deployment Modes<a class="headerlink" href="#deployment-modes" title="Link to this heading">#</a></h2>
<section id="co-launch-router-and-workers">
<h3>Co-launch Router and Workers<a class="headerlink" href="#co-launch-router-and-workers" title="Link to this heading">#</a></h3>
<p>Launch the router and a fleet of SGLang workers in one process:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_server<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--model<span class="w"> </span>meta-llama/Meta-Llama-3.1-8B-Instruct<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--dp-size<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--host<span class="w"> </span><span class="m">0</span>.0.0.0<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--port<span class="w"> </span><span class="m">30000</span>
</pre></div>
</div>
<p>Comprehensive example with router arguments (prefixed with <code class="docutils literal notranslate"><span class="pre">--router-</span></code>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_server<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--host<span class="w"> </span><span class="m">0</span>.0.0.0<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--port<span class="w"> </span><span class="m">8080</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--model<span class="w"> </span>meta-llama/Llama-3.1-8B-Instruct<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--tp-size<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--dp-size<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--grpc-mode<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--log-level<span class="w"> </span>debug<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--router-prometheus-port<span class="w"> </span><span class="m">10001</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--router-tool-call-parser<span class="w"> </span>llama<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--router-model-path<span class="w"> </span>meta-llama/Llama-3.1-8B-Instruct<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--router-policy<span class="w"> </span>round_robin<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--router-log-level<span class="w"> </span>debug
</pre></div>
</div>
</section>
<section id="separate-launch-http">
<h3>Separate Launch (HTTP)<a class="headerlink" href="#separate-launch-http" title="Link to this heading">#</a></h3>
<p>Run workers independently and point the router at their HTTP endpoints:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Worker nodes</span>
python<span class="w"> </span>-m<span class="w"> </span>sglang.launch_server<span class="w"> </span>--model<span class="w"> </span>meta-llama/Meta-Llama-3.1-8B-Instruct<span class="w"> </span>--port<span class="w"> </span><span class="m">8000</span>
python<span class="w"> </span>-m<span class="w"> </span>sglang.launch_server<span class="w"> </span>--model<span class="w"> </span>meta-llama/Meta-Llama-3.1-8B-Instruct<span class="w"> </span>--port<span class="w"> </span><span class="m">8001</span>

<span class="c1"># Router node</span>
python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-urls<span class="w"> </span>http://worker1:8000<span class="w"> </span>http://worker2:8001<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--policy<span class="w"> </span>cache_aware<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--host<span class="w"> </span><span class="m">0</span>.0.0.0<span class="w"> </span>--port<span class="w"> </span><span class="m">30000</span>
</pre></div>
</div>
</section>
<section id="grpc-launch">
<h3>gRPC Launch<a class="headerlink" href="#grpc-launch" title="Link to this heading">#</a></h3>
<p>Use SRT gRPC workers to unlock the highest throughput and access native reasoning/tool pipelines:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Workers expose gRPC endpoints</span>
python<span class="w"> </span>-m<span class="w"> </span>sglang.launch_server<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--model<span class="w"> </span>meta-llama/Llama-3.1-8B-Instruct<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--grpc-mode<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--port<span class="w"> </span><span class="m">20000</span>

<span class="c1"># Router</span>
python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-urls<span class="w"> </span>grpc://127.0.0.1:20000<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--model-path<span class="w"> </span>meta-llama/Llama-3.1-8B-Instruct<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--reasoning-parser<span class="w"> </span>deepseek-r1<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--tool-call-parser<span class="w"> </span>json<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--host<span class="w"> </span><span class="m">0</span>.0.0.0<span class="w"> </span>--port<span class="w"> </span><span class="m">8080</span>
</pre></div>
</div>
<p>The gRPC router supports both regular HTTP-equivalent serving and PD (prefill/decode) serving. Provide <code class="docutils literal notranslate"><span class="pre">--tokenizer-path</span></code> or <code class="docutils literal notranslate"><span class="pre">--model-path</span></code> (HuggingFace ID or local directory) whenever connection mode resolves to gRPC.</p>
</section>
<section id="prefill-decode-disaggregation">
<h3>Prefill-Decode Disaggregation<a class="headerlink" href="#prefill-decode-disaggregation" title="Link to this heading">#</a></h3>
<p>Split prefill and decode workers for PD-aware caching and balancing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--pd-disaggregation<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--prefill<span class="w"> </span>http://prefill1:30001<span class="w"> </span><span class="m">9001</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--decode<span class="w"> </span>http://decode1:30011<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--prefill-policy<span class="w"> </span>cache_aware<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--decode-policy<span class="w"> </span>power_of_two
</pre></div>
</div>
<p>Prefill entries accept an optional bootstrap port. PD mode merges prefill metadata with decode outputs and streams results back to the client.</p>
</section>
<section id="openai-backend-proxy">
<h3>OpenAI Backend Proxy<a class="headerlink" href="#openai-backend-proxy" title="Link to this heading">#</a></h3>
<p>Proxy OpenAI-compatible endpoints while keeping history and MCP sessions local:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--backend<span class="w"> </span>openai<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-urls<span class="w"> </span>https://api.openai.com<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--history-backend<span class="w"> </span>memory
</pre></div>
</div>
<p>OpenAI backend mode expects exactly one <code class="docutils literal notranslate"><span class="pre">--worker-urls</span></code> entry per router instance.</p>
</section>
<section id="multi-model-inference-gateway">
<h3>Multi-Model Inference Gateway<a class="headerlink" href="#multi-model-inference-gateway" title="Link to this heading">#</a></h3>
<p>Enable IGW mode to route multiple models through a single router:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./target/release/sgl-model-gateway<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--enable-igw<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--policy<span class="w"> </span>cache_aware<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--max-concurrent-requests<span class="w"> </span><span class="m">512</span>

<span class="c1"># Register workers dynamically</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:30000/workers<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">        &quot;url&quot;: &quot;http://worker-a:8000&quot;,</span>
<span class="s1">        &quot;model_id&quot;: &quot;mistral&quot;,</span>
<span class="s1">        &quot;priority&quot;: 10,</span>
<span class="s1">        &quot;labels&quot;: {&quot;tier&quot;: &quot;gold&quot;}</span>
<span class="s1">      }&#39;</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="api-reference">
<h2>API Reference<a class="headerlink" href="#api-reference" title="Link to this heading">#</a></h2>
<section id="inference-endpoints">
<h3>Inference Endpoints<a class="headerlink" href="#inference-endpoints" title="Link to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Path</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">POST</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/generate</span></code></p></td>
<td><p>SGLang generate API</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">POST</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v1/chat/completions</span></code></p></td>
<td><p>OpenAI-compatible chat completions (streaming/tool calls)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">POST</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v1/completions</span></code></p></td>
<td><p>OpenAI-compatible text completions</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">POST</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v1/embeddings</span></code></p></td>
<td><p>Embedding generation (HTTP and gRPC)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">POST</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v1/rerank</span></code>, <code class="docutils literal notranslate"><span class="pre">/rerank</span></code></p></td>
<td><p>Reranking requests</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">POST</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v1/classify</span></code></p></td>
<td><p>Text classification</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="tokenization-endpoints">
<h3>Tokenization Endpoints<a class="headerlink" href="#tokenization-endpoints" title="Link to this heading">#</a></h3>
<p>The gateway provides HTTP endpoints for text tokenization with batch support, designed to mirror the SGLang Python tokenization API.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Path</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">POST</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v1/tokenize</span></code></p></td>
<td><p>Tokenize text to token IDs (single or batch)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">POST</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v1/detokenize</span></code></p></td>
<td><p>Convert token IDs back to text (single or batch)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">POST</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v1/tokenizers</span></code></p></td>
<td><p>Register a new tokenizer (async, returns job status)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">GET</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v1/tokenizers</span></code></p></td>
<td><p>List all registered tokenizers</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">GET</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v1/tokenizers/{id}</span></code></p></td>
<td><p>Get tokenizer info by UUID</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">GET</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v1/tokenizers/{id}/status</span></code></p></td>
<td><p>Check async tokenizer loading status</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DELETE</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v1/tokenizers/{id}</span></code></p></td>
<td><p>Remove a tokenizer from the registry</p></td>
</tr>
</tbody>
</table>
</div>
<section id="tokenize-request">
<h4>Tokenize Request<a class="headerlink" href="#tokenize-request" title="Link to this heading">#</a></h4>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;model&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;meta-llama/Llama-3.1-8B-Instruct&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;prompt&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Hello, world!&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="batch-tokenize-request">
<h4>Batch Tokenize Request<a class="headerlink" href="#batch-tokenize-request" title="Link to this heading">#</a></h4>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;model&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;meta-llama/Llama-3.1-8B-Instruct&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;prompt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;World&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;How are you?&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="tokenize-response">
<h4>Tokenize Response<a class="headerlink" href="#tokenize-response" title="Link to this heading">#</a></h4>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;tokens&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">15339</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">1917</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;char_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">13</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="detokenize-request">
<h4>Detokenize Request<a class="headerlink" href="#detokenize-request" title="Link to this heading">#</a></h4>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;model&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;meta-llama/Llama-3.1-8B-Instruct&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;tokens&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">15339</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">1917</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;skip_special_tokens&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="detokenize-response">
<h4>Detokenize Response<a class="headerlink" href="#detokenize-response" title="Link to this heading">#</a></h4>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Hello, world!&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="add-tokenizer-async">
<h4>Add Tokenizer (Async)<a class="headerlink" href="#add-tokenizer-async" title="Link to this heading">#</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:30000/v1/tokenizers<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;name&quot;: &quot;llama3&quot;, &quot;source&quot;: &quot;meta-llama/Llama-3.1-8B-Instruct&quot;}&#39;</span>
</pre></div>
</div>
<p>Response:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;550e8400-e29b-41d4-a716-446655440000&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pending&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Tokenizer registration queued&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Check status:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>http://localhost:30000/v1/tokenizers/550e8400-e29b-41d4-a716-446655440000/status
</pre></div>
</div>
</section>
</section>
<section id="parser-endpoints">
<h3>Parser Endpoints<a class="headerlink" href="#parser-endpoints" title="Link to this heading">#</a></h3>
<p>The gateway provides admin endpoints for parsing reasoning content and function calls from LLM outputs.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Path</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">POST</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/parse/reasoning</span></code></p></td>
<td><p>Separate reasoning (<code class="docutils literal notranslate"><span class="pre">&lt;think&gt;</span></code>) from normal text</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">POST</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/parse/function_call</span></code></p></td>
<td><p>Parse function/tool calls from text</p></td>
</tr>
</tbody>
</table>
</div>
<section id="separate-reasoning-request">
<h4>Separate Reasoning Request<a class="headerlink" href="#separate-reasoning-request" title="Link to this heading">#</a></h4>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;think&gt;Let me analyze this step by step...&lt;/think&gt;The answer is 42.&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;parser&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;deepseek-r1&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="response">
<h4>Response<a class="headerlink" href="#response" title="Link to this heading">#</a></h4>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;normal_text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The answer is 42.&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;reasoning_text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Let me analyze this step by step...&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="function-call-parsing">
<h4>Function Call Parsing<a class="headerlink" href="#function-call-parsing" title="Link to this heading">#</a></h4>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{\&quot;name\&quot;: \&quot;get_weather\&quot;, \&quot;arguments\&quot;: {\&quot;city\&quot;: \&quot;NYC\&quot;}}&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;parser&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;json&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="classification-api">
<h3>Classification API<a class="headerlink" href="#classification-api" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">/v1/classify</span></code> endpoint provides text classification using sequence classification models (e.g., <code class="docutils literal notranslate"><span class="pre">Qwen2ForSequenceClassification</span></code>, <code class="docutils literal notranslate"><span class="pre">BertForSequenceClassification</span></code>).</p>
<section id="request">
<h4>Request<a class="headerlink" href="#request" title="Link to this heading">#</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>http://localhost:30000/v1/classify<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;model&quot;: &quot;jason9693/Qwen2.5-1.5B-apeach&quot;,</span>
<span class="s1">    &quot;input&quot;: &quot;I love this product!&quot;</span>
<span class="s1">  }&#39;</span>
</pre></div>
</div>
</section>
<section id="id1">
<h4>Response<a class="headerlink" href="#id1" title="Link to this heading">#</a></h4>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;classify-a1b2c3d4-5678-90ab-cdef-1234567890ab&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;object&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;list&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;created&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1767034308</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;model&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;jason9693/Qwen2.5-1.5B-apeach&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;positive&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;probs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">0.12</span><span class="p">,</span><span class="w"> </span><span class="mf">0.88</span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;num_classes&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;usage&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;prompt_tokens&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;completion_tokens&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;total_tokens&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="response-fields">
<h4>Response Fields<a class="headerlink" href="#response-fields" title="Link to this heading">#</a></h4>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">label</span></code></p></td>
<td><p>Predicted class label (from models <code class="docutils literal notranslate"><span class="pre">id2label</span></code> config, or <code class="docutils literal notranslate"><span class="pre">LABEL_N</span></code> fallback)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">probs</span></code></p></td>
<td><p>Probability distribution over all classes (softmax of logits)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">num_classes</span></code></p></td>
<td><p>Number of classification classes</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="notes">
<h4>Notes<a class="headerlink" href="#notes" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>Classification reuses the embedding backendthe scheduler returns logits which are converted to probabilities via softmax</p></li>
<li><p>Labels come from the models HuggingFace config (<code class="docutils literal notranslate"><span class="pre">id2label</span></code> field); models without this mapping use generic labels (<code class="docutils literal notranslate"><span class="pre">LABEL_0</span></code>, <code class="docutils literal notranslate"><span class="pre">LABEL_1</span></code>, etc.)</p></li>
<li><p>Both HTTP and gRPC routers support classification</p></li>
</ul>
</section>
</section>
<section id="conversation-and-response-apis">
<h3>Conversation and Response APIs<a class="headerlink" href="#conversation-and-response-apis" title="Link to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Path</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">POST</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v1/responses</span></code></p></td>
<td><p>Create background responses (agentic loops)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">GET</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v1/responses/{id}</span></code></p></td>
<td><p>Retrieve stored response</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">POST</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v1/responses/{id}/cancel</span></code></p></td>
<td><p>Cancel background response</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DELETE</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v1/responses/{id}</span></code></p></td>
<td><p>Delete response</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">GET</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v1/responses/{id}/input_items</span></code></p></td>
<td><p>List response input items</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">POST</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v1/conversations</span></code></p></td>
<td><p>Create conversation</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">GET</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v1/conversations/{id}</span></code></p></td>
<td><p>Get conversation</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">POST</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v1/conversations/{id}</span></code></p></td>
<td><p>Update conversation</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DELETE</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v1/conversations/{id}</span></code></p></td>
<td><p>Delete conversation</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">GET</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v1/conversations/{id}/items</span></code></p></td>
<td><p>List conversation items</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">POST</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v1/conversations/{id}/items</span></code></p></td>
<td><p>Add items to conversation</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">GET</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v1/conversations/{id}/items/{item_id}</span></code></p></td>
<td><p>Get conversation item</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DELETE</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v1/conversations/{id}/items/{item_id}</span></code></p></td>
<td><p>Delete conversation item</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="worker-management-apis">
<h3>Worker Management APIs<a class="headerlink" href="#worker-management-apis" title="Link to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Path</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">POST</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/workers</span></code></p></td>
<td><p>Queue worker registration (returns 202 Accepted)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">GET</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/workers</span></code></p></td>
<td><p>List workers with health, load, and policy metadata</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">GET</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/workers/{worker_id}</span></code></p></td>
<td><p>Inspect specific worker or job queue entry</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">PUT</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/workers/{worker_id}</span></code></p></td>
<td><p>Queue worker update</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DELETE</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/workers/{worker_id}</span></code></p></td>
<td><p>Queue worker removal</p></td>
</tr>
</tbody>
</table>
</div>
<section id="add-worker">
<h4>Add Worker<a class="headerlink" href="#add-worker" title="Link to this heading">#</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:30000/workers<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;url&quot;:&quot;grpc://0.0.0.0:31000&quot;,&quot;worker_type&quot;:&quot;regular&quot;}&#39;</span>
</pre></div>
</div>
</section>
<section id="list-workers">
<h4>List Workers<a class="headerlink" href="#list-workers" title="Link to this heading">#</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>http://localhost:30000/workers
</pre></div>
</div>
<p>Response:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;workers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2f3a0c3e-3a7b-4c3f-8c70-1b7d4c3a6e1f&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://0.0.0.0:31378&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;model_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mistral&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;priority&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;cost&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;worker_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;regular&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;is_healthy&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;load&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;connection_mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Http&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;total&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;stats&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;prefill_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;decode_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;regular_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="admin-and-health-endpoints">
<h3>Admin and Health Endpoints<a class="headerlink" href="#admin-and-health-endpoints" title="Link to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Path</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">GET</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/liveness</span></code></p></td>
<td><p>Health check (always returns OK)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">GET</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/readiness</span></code></p></td>
<td><p>Readiness check (checks healthy worker availability)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">GET</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/health</span></code></p></td>
<td><p>Alias for liveness</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">GET</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/health_generate</span></code></p></td>
<td><p>Health generate test</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">GET</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/engine_metrics</span></code></p></td>
<td><p>Engine-level metrics from workers</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">GET</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/v1/models</span></code></p></td>
<td><p>List available models</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">GET</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/get_model_info</span></code></p></td>
<td><p>Get model information</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">GET</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/get_server_info</span></code></p></td>
<td><p>Get server information</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">POST</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/flush_cache</span></code></p></td>
<td><p>Clear all caches</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">GET</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/get_loads</span></code></p></td>
<td><p>Get all worker loads</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">POST</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/wasm</span></code></p></td>
<td><p>Upload WASM module</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">GET</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/wasm</span></code></p></td>
<td><p>List WASM modules</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DELETE</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">/wasm/{module_uuid}</span></code></p></td>
<td><p>Remove WASM module</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<hr class="docutils" />
<section id="load-balancing-policies">
<h2>Load Balancing Policies<a class="headerlink" href="#load-balancing-policies" title="Link to this heading">#</a></h2>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Policy</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Usage</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">random</span></code></p></td>
<td><p>Uniform random selection</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--policy</span> <span class="pre">random</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">round_robin</span></code></p></td>
<td><p>Cycles through workers in order</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--policy</span> <span class="pre">round_robin</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">power_of_two</span></code></p></td>
<td><p>Samples two workers and picks the lighter one</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--policy</span> <span class="pre">power_of_two</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">cache_aware</span></code></p></td>
<td><p>Combines cache locality with load balancing (default)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--policy</span> <span class="pre">cache_aware</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">bucket</span></code></p></td>
<td><p>Divides workers into load buckets with dynamic boundaries</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--policy</span> <span class="pre">bucket</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<section id="cache-aware-policy-tuning">
<h3>Cache-Aware Policy Tuning<a class="headerlink" href="#cache-aware-policy-tuning" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--cache-threshold<span class="w"> </span><span class="m">0</span>.5<span class="w"> </span><span class="se">\</span>
--balance-abs-threshold<span class="w"> </span><span class="m">32</span><span class="w"> </span><span class="se">\</span>
--balance-rel-threshold<span class="w"> </span><span class="m">1</span>.5<span class="w"> </span><span class="se">\</span>
--eviction-interval-secs<span class="w"> </span><span class="m">120</span><span class="w"> </span><span class="se">\</span>
--max-tree-size<span class="w"> </span><span class="m">67108864</span>
</pre></div>
</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--cache-threshold</span></code></p></td>
<td><p>0.3</p></td>
<td><p>Minimum prefix match ratio for cache hit</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--balance-abs-threshold</span></code></p></td>
<td><p>64</p></td>
<td><p>Absolute load difference before rebalancing</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--balance-rel-threshold</span></code></p></td>
<td><p>1.5</p></td>
<td><p>Relative load ratio before rebalancing</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--eviction-interval-secs</span></code></p></td>
<td><p>120</p></td>
<td><p>Cache eviction cadence in seconds</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--max-tree-size</span></code></p></td>
<td><p>67108864</p></td>
<td><p>Maximum nodes in cache tree</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<hr class="docutils" />
<section id="reliability-and-flow-control">
<h2>Reliability and Flow Control<a class="headerlink" href="#reliability-and-flow-control" title="Link to this heading">#</a></h2>
<section id="retries">
<h3>Retries<a class="headerlink" href="#retries" title="Link to this heading">#</a></h3>
<p>Configure exponential backoff retries:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-urls<span class="w"> </span>http://worker1:8000<span class="w"> </span>http://worker2:8001<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--retry-max-retries<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--retry-initial-backoff-ms<span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--retry-max-backoff-ms<span class="w"> </span><span class="m">30000</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--retry-backoff-multiplier<span class="w"> </span><span class="m">1</span>.5<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--retry-jitter-factor<span class="w"> </span><span class="m">0</span>.2
</pre></div>
</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--retry-max-retries</span></code></p></td>
<td><p>5</p></td>
<td><p>Maximum retry attempts</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--retry-initial-backoff-ms</span></code></p></td>
<td><p>50</p></td>
<td><p>Initial backoff duration (ms)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--retry-max-backoff-ms</span></code></p></td>
<td><p>5000</p></td>
<td><p>Maximum backoff duration (ms)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--retry-backoff-multiplier</span></code></p></td>
<td><p>2.0</p></td>
<td><p>Exponential backoff multiplier</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--retry-jitter-factor</span></code></p></td>
<td><p>0.1</p></td>
<td><p>Random jitter factor (0.0-1.0)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--disable-retries</span></code></p></td>
<td><p>false</p></td>
<td><p>Disable retries entirely</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Retryable Status Codes:</strong> 408, 429, 500, 502, 503, 504</p>
</section>
<section id="circuit-breaker">
<h3>Circuit Breaker<a class="headerlink" href="#circuit-breaker" title="Link to this heading">#</a></h3>
<p>Per-worker circuit breakers prevent cascading failures:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-urls<span class="w"> </span>http://worker1:8000<span class="w"> </span>http://worker2:8001<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cb-failure-threshold<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cb-success-threshold<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cb-timeout-duration-secs<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cb-window-duration-secs<span class="w"> </span><span class="m">60</span>
</pre></div>
</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--cb-failure-threshold</span></code></p></td>
<td><p>5</p></td>
<td><p>Consecutive failures to open circuit</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--cb-success-threshold</span></code></p></td>
<td><p>2</p></td>
<td><p>Successes to close from half-open</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--cb-timeout-duration-secs</span></code></p></td>
<td><p>30</p></td>
<td><p>Time before half-open attempt</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--cb-window-duration-secs</span></code></p></td>
<td><p>60</p></td>
<td><p>Failure counting window</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--disable-circuit-breaker</span></code></p></td>
<td><p>false</p></td>
<td><p>Disable circuit breaker</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Circuit Breaker States:</strong></p>
<ul class="simple">
<li><p><strong>Closed</strong>: Normal operation, requests allowed</p></li>
<li><p><strong>Open</strong>: Failing, requests rejected immediately</p></li>
<li><p><strong>Half-Open</strong>: Testing recovery, limited requests allowed</p></li>
</ul>
</section>
<section id="rate-limiting-and-queuing">
<h3>Rate Limiting and Queuing<a class="headerlink" href="#rate-limiting-and-queuing" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-urls<span class="w"> </span>http://worker1:8000<span class="w"> </span>http://worker2:8001<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--max-concurrent-requests<span class="w"> </span><span class="m">256</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--rate-limit-tokens-per-second<span class="w"> </span><span class="m">512</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--queue-size<span class="w"> </span><span class="m">128</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--queue-timeout-secs<span class="w"> </span><span class="m">30</span>
</pre></div>
</div>
<p>Requests beyond the concurrency limit wait in a FIFO queue. Returns:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">429</span> <span class="pre">Too</span> <span class="pre">Many</span> <span class="pre">Requests</span></code> when queue is full</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">408</span> <span class="pre">Request</span> <span class="pre">Timeout</span></code> when queue timeout expires</p></li>
</ul>
</section>
<section id="health-checks">
<h3>Health Checks<a class="headerlink" href="#health-checks" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--health-check-interval-secs<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="se">\</span>
--health-check-timeout-secs<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="se">\</span>
--health-success-threshold<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
--health-failure-threshold<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="se">\</span>
--health-check-endpoint<span class="w"> </span>/health
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="reasoning-parser-integration">
<h2>Reasoning Parser Integration<a class="headerlink" href="#reasoning-parser-integration" title="Link to this heading">#</a></h2>
<p>The gateway includes built-in reasoning parsers for models that use Chain-of-Thought (CoT) reasoning with explicit thinking blocks.</p>
<section id="supported-parsers">
<h3>Supported Parsers<a class="headerlink" href="#supported-parsers" title="Link to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Parser ID</p></th>
<th class="head"><p>Model Family</p></th>
<th class="head"><p>Think Tokens</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">deepseek-r1</span></code></p></td>
<td><p>DeepSeek-R1</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;think&gt;...&lt;/think&gt;</span></code> (initial reasoning)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">qwen3</span></code></p></td>
<td><p>Qwen-3</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;think&gt;...&lt;/think&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">qwen3-thinking</span></code></p></td>
<td><p>Qwen-3 Thinking</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;think&gt;...&lt;/think&gt;</span></code> (initial reasoning)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">kimi</span></code></p></td>
<td><p>Kimi K2</p></td>
<td><p>Unicode think tokens</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">glm45</span></code></p></td>
<td><p>GLM-4.5/4.6/4.7</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;think&gt;...&lt;/think&gt;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">step3</span></code></p></td>
<td><p>Step-3</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;think&gt;...&lt;/think&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">minimax</span></code></p></td>
<td><p>MiniMax</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;think&gt;...&lt;/think&gt;</span></code></p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-urls<span class="w"> </span>grpc://127.0.0.1:20000<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--model-path<span class="w"> </span>deepseek-ai/DeepSeek-R1<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--reasoning-parser<span class="w"> </span>deepseek-r1
</pre></div>
</div>
<p>The gRPC router automatically:</p>
<ol class="arabic simple">
<li><p>Detects reasoning blocks in streaming output</p></li>
<li><p>Separates reasoning content from normal text</p></li>
<li><p>Applies incremental streaming parsing with buffer management</p></li>
<li><p>Handles partial token detection for correct streaming behavior</p></li>
</ol>
</section>
</section>
<hr class="docutils" />
<section id="tool-call-parsing">
<h2>Tool Call Parsing<a class="headerlink" href="#tool-call-parsing" title="Link to this heading">#</a></h2>
<p>The gateway supports parsing function/tool calls from LLM outputs in multiple formats.</p>
<section id="supported-formats">
<h3>Supported Formats<a class="headerlink" href="#supported-formats" title="Link to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Parser</p></th>
<th class="head"><p>Format</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">json</span></code></p></td>
<td><p>JSON</p></td>
<td><p>Standard JSON tool calls</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">python</span></code></p></td>
<td><p>Pythonic</p></td>
<td><p>Python function call syntax</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">xml</span></code></p></td>
<td><p>XML</p></td>
<td><p>XML-formatted tool calls</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="id2">
<h3>Usage<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-urls<span class="w"> </span>grpc://127.0.0.1:20000<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--model-path<span class="w"> </span>meta-llama/Llama-3.1-8B-Instruct<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--tool-call-parser<span class="w"> </span>json
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="tokenizer-management">
<h2>Tokenizer Management<a class="headerlink" href="#tokenizer-management" title="Link to this heading">#</a></h2>
<section id="tokenizer-sources">
<h3>Tokenizer Sources<a class="headerlink" href="#tokenizer-sources" title="Link to this heading">#</a></h3>
<p>The gateway supports multiple tokenizer backends:</p>
<ul class="simple">
<li><p><strong>HuggingFace</strong>: Load from HuggingFace Hub by model ID</p></li>
<li><p><strong>Local</strong>: Load from local <code class="docutils literal notranslate"><span class="pre">tokenizer.json</span></code> or directory</p></li>
<li><p><strong>Tiktoken</strong>: Auto-detect OpenAI GPT models (gpt-4, davinci, etc.)</p></li>
</ul>
</section>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># HuggingFace model</span>
--model-path<span class="w"> </span>meta-llama/Llama-3.1-8B-Instruct

<span class="c1"># Local tokenizer</span>
--tokenizer-path<span class="w"> </span>/path/to/tokenizer.json

<span class="c1"># With chat template override</span>
--chat-template<span class="w"> </span>/path/to/template.jinja
</pre></div>
</div>
</section>
<section id="tokenizer-caching">
<h3>Tokenizer Caching<a class="headerlink" href="#tokenizer-caching" title="Link to this heading">#</a></h3>
<p>Two-level caching for optimal performance:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Cache</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>L0</p></td>
<td><p>Exact match</p></td>
<td><p>Whole-string caching for repeated prompts</p></td>
</tr>
<tr class="row-odd"><td><p>L1</p></td>
<td><p>Prefix match</p></td>
<td><p>Prefix boundary matching for incremental prompts</p></td>
</tr>
</tbody>
</table>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--enable-l0-cache<span class="w"> </span><span class="se">\</span>
--l0-max-entries<span class="w"> </span><span class="m">10000</span><span class="w"> </span><span class="se">\</span>
--enable-l1-cache<span class="w"> </span><span class="se">\</span>
--l1-max-memory<span class="w"> </span><span class="m">52428800</span><span class="w">  </span><span class="c1"># 50MB</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="mcp-integration">
<h2>MCP Integration<a class="headerlink" href="#mcp-integration" title="Link to this heading">#</a></h2>
<p>The gateway provides native Model Context Protocol (MCP) client integration for tool execution.</p>
<section id="supported-transports">
<h3>Supported Transports<a class="headerlink" href="#supported-transports" title="Link to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Transport</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>STDIO</p></td>
<td><p>Local process execution</p></td>
</tr>
<tr class="row-odd"><td><p>SSE</p></td>
<td><p>Server-Sent Events (HTTP)</p></td>
</tr>
<tr class="row-even"><td><p>Streamable</p></td>
<td><p>Bidirectional streaming</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="id3">
<h3>Configuration<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--mcp-config-path<span class="w"> </span>/path/to/mcp-config.yaml<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-urls<span class="w"> </span>http://worker1:8000
</pre></div>
</div>
</section>
<section id="mcp-configuration-file">
<h3>MCP Configuration File<a class="headerlink" href="#mcp-configuration-file" title="Link to this heading">#</a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">servers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;filesystem&quot;</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;npx&quot;</span>
<span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;-y&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;@modelcontextprotocol/server-filesystem&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;/tmp&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;stdio&quot;</span>
<span class="w">    </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;github&quot;</span>
<span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://api.github.com/mcp&quot;</span>
<span class="w">    </span><span class="nt">token</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ghp_xxxxx&quot;</span>
<span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;sse&quot;</span>
<span class="w">    </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;custom-tools&quot;</span>
<span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://tools.example.com/mcp&quot;</span>
<span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;streamable&quot;</span>
<span class="w">    </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="nt">pool</span><span class="p">:</span>
<span class="w">  </span><span class="nt">max_connections</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">  </span><span class="nt">idle_timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300</span>

<span class="nt">proxy</span><span class="p">:</span>
<span class="w">  </span><span class="nt">http</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://proxy.internal:8080&quot;</span>
<span class="w">  </span><span class="nt">https</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://proxy.internal:8443&quot;</span>
<span class="w">  </span><span class="nt">no_proxy</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;localhost,127.0.0.1,*.internal&quot;</span>

<span class="nt">inventory</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enable_refresh</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">tool_ttl</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300</span>
<span class="w">  </span><span class="nt">refresh_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="service-discovery-kubernetes">
<h2>Service Discovery (Kubernetes)<a class="headerlink" href="#service-discovery-kubernetes" title="Link to this heading">#</a></h2>
<p>Enable automatic worker discovery via Kubernetes pod selectors:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--service-discovery<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--selector<span class="w"> </span><span class="nv">app</span><span class="o">=</span>sglang-worker<span class="w"> </span><span class="nv">role</span><span class="o">=</span>inference<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--service-discovery-namespace<span class="w"> </span>production<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--service-discovery-port<span class="w"> </span><span class="m">8000</span>
</pre></div>
</div>
<section id="pd-mode-discovery">
<h3>PD Mode Discovery<a class="headerlink" href="#pd-mode-discovery" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--pd-disaggregation<span class="w"> </span><span class="se">\</span>
--prefill-selector<span class="w"> </span><span class="nv">app</span><span class="o">=</span>sglang<span class="w"> </span><span class="nv">component</span><span class="o">=</span>prefill<span class="w"> </span><span class="se">\</span>
--decode-selector<span class="w"> </span><span class="nv">app</span><span class="o">=</span>sglang<span class="w"> </span><span class="nv">component</span><span class="o">=</span>decode<span class="w"> </span><span class="se">\</span>
--service-discovery
</pre></div>
</div>
<p>Prefill pods can expose bootstrap ports via the <code class="docutils literal notranslate"><span class="pre">sglang.ai/bootstrap-port</span></code> annotation. RBAC must allow <code class="docutils literal notranslate"><span class="pre">get</span></code>, <code class="docutils literal notranslate"><span class="pre">list</span></code>, and <code class="docutils literal notranslate"><span class="pre">watch</span></code> on pods.</p>
</section>
</section>
<hr class="docutils" />
<section id="history-and-data-connectors">
<h2>History and Data Connectors<a class="headerlink" href="#history-and-data-connectors" title="Link to this heading">#</a></h2>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Backend</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Usage</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">memory</span></code></p></td>
<td><p>In-memory storage (default)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--history-backend</span> <span class="pre">memory</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">none</span></code></p></td>
<td><p>No persistence</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--history-backend</span> <span class="pre">none</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">oracle</span></code></p></td>
<td><p>Oracle Autonomous Database</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--history-backend</span> <span class="pre">oracle</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">postgres</span></code></p></td>
<td><p>PostgreSQL Database</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--history-backend</span> <span class="pre">postgres</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">redis</span></code></p></td>
<td><p>Redis</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--history-backend</span> <span class="pre">redis</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<section id="oracle-configuration">
<h3>Oracle Configuration<a class="headerlink" href="#oracle-configuration" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Connection descriptor</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">ATP_DSN</span><span class="o">=</span><span class="s2">&quot;(description=(address=(protocol=tcps)(port=1522)(host=adb.region.oraclecloud.com))(connect_data=(service_name=service_name)))&quot;</span>

<span class="c1"># Or TNS alias (requires wallet)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">ATP_TNS_ALIAS</span><span class="o">=</span><span class="s2">&quot;sglroutertestatp_high&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">ATP_WALLET_PATH</span><span class="o">=</span><span class="s2">&quot;/path/to/wallet&quot;</span>

<span class="c1"># Credentials</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">ATP_USER</span><span class="o">=</span><span class="s2">&quot;admin&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">ATP_PASSWORD</span><span class="o">=</span><span class="s2">&quot;secret&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">ATP_POOL_MIN</span><span class="o">=</span><span class="m">4</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">ATP_POOL_MAX</span><span class="o">=</span><span class="m">32</span>

python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--backend<span class="w"> </span>openai<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-urls<span class="w"> </span>https://api.openai.com<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--history-backend<span class="w"> </span>oracle
</pre></div>
</div>
</section>
<section id="postgresql-configuration">
<h3>PostgreSQL Configuration<a class="headerlink" href="#postgresql-configuration" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">POSTGRES_DB_URL</span><span class="o">=</span><span class="s2">&quot;postgres://user:password@host:5432/dbname&quot;</span>

python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--backend<span class="w"> </span>openai<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-urls<span class="w"> </span>https://api.openai.com<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--history-backend<span class="w"> </span>postgres
</pre></div>
</div>
</section>
<section id="redis-configuration">
<h3>Redis Configuration<a class="headerlink" href="#redis-configuration" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">REDIS_URL</span><span class="o">=</span><span class="s2">&quot;redis://localhost:6379&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">REDIS_POOL_MAX</span><span class="o">=</span><span class="m">16</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">REDIS_RETENTION_DAYS</span><span class="o">=</span><span class="m">30</span>

python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--backend<span class="w"> </span>openai<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-urls<span class="w"> </span>https://api.openai.com<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--history-backend<span class="w"> </span>redis<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--redis-retention-days<span class="w"> </span><span class="m">30</span>
</pre></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">--redis-retention-days</span> <span class="pre">-1</span></code> for persistent storage (default is 30 days).</p>
</section>
</section>
<hr class="docutils" />
<section id="wasm-middleware">
<h2>WASM Middleware<a class="headerlink" href="#wasm-middleware" title="Link to this heading">#</a></h2>
<p>The gateway supports WebAssembly (WASM) middleware modules for custom request/response processing. This enables organization-specific logic for authentication, rate limiting, billing, logging, and morewithout modifying or recompiling the gateway.</p>
<section id="id4">
<h3>Overview<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<p>WASM middleware runs in a sandboxed environment with memory isolation, no network/filesystem access, and configurable resource limits.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Attach Point</p></th>
<th class="head"><p>When Executed</p></th>
<th class="head"><p>Use Cases</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">OnRequest</span></code></p></td>
<td><p>Before forwarding to workers</p></td>
<td><p>Auth, rate limiting, request modification</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">OnResponse</span></code></p></td>
<td><p>After receiving worker response</p></td>
<td><p>Logging, response modification, error handling</p></td>
</tr>
</tbody>
</table>
</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Action</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Continue</span></code></p></td>
<td><p>Proceed without modification</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Reject(status)</span></code></p></td>
<td><p>Reject request with HTTP status code</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Modify(...)</span></code></p></td>
<td><p>Modify headers, body, or status</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Link to this heading">#</a></h3>
<p>Complete working examples are available in <code class="docutils literal notranslate"><span class="pre">examples/wasm/</span></code>:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Example</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">auth/</span></code></p></td>
<td><p>API key authentication for protected routes</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">rate_limit/</span></code></p></td>
<td><p>Per-client rate limiting (requests/minute)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">logging/</span></code></p></td>
<td><p>Request tracking headers and response modification</p></td>
</tr>
</tbody>
</table>
</div>
<p>The interface definition is located at <code class="docutils literal notranslate"><span class="pre">src/wasm/interface</span></code>.</p>
</section>
<section id="building-modules">
<h3>Building Modules<a class="headerlink" href="#building-modules" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prerequisites</span>
rustup<span class="w"> </span>target<span class="w"> </span>add<span class="w"> </span>wasm32-wasip2
cargo<span class="w"> </span>install<span class="w"> </span>wasm-tools

<span class="c1"># Build</span>
cargo<span class="w"> </span>build<span class="w"> </span>--target<span class="w"> </span>wasm32-wasip2<span class="w"> </span>--release

<span class="c1"># Convert to component format</span>
wasm-tools<span class="w"> </span>component<span class="w"> </span>new<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>target/wasm32-wasip2/release/my_middleware.wasm<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-o<span class="w"> </span>my_middleware.component.wasm
</pre></div>
</div>
</section>
<section id="deploying-modules">
<h3>Deploying Modules<a class="headerlink" href="#deploying-modules" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Enable WASM support</span>
python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-urls<span class="w"> </span>http://worker1:8000<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--enable-wasm

<span class="c1"># Upload module</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:30000/wasm<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;modules&quot;: [{</span>
<span class="s1">      &quot;name&quot;: &quot;auth-middleware&quot;,</span>
<span class="s1">      &quot;file_path&quot;: &quot;/absolute/path/to/auth.component.wasm&quot;,</span>
<span class="s1">      &quot;module_type&quot;: &quot;Middleware&quot;,</span>
<span class="s1">      &quot;attach_points&quot;: [{&quot;Middleware&quot;: &quot;OnRequest&quot;}]</span>
<span class="s1">    }]</span>
<span class="s1">  }&#39;</span>

<span class="c1"># List modules</span>
curl<span class="w"> </span>http://localhost:30000/wasm

<span class="c1"># Remove module</span>
curl<span class="w"> </span>-X<span class="w"> </span>DELETE<span class="w"> </span>http://localhost:30000/wasm/<span class="o">{</span>module_uuid<span class="o">}</span>
</pre></div>
</div>
</section>
<section id="runtime-configuration">
<h3>Runtime Configuration<a class="headerlink" href="#runtime-configuration" title="Link to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">max_memory_pages</span></code></p></td>
<td><p>1024 (64MB)</p></td>
<td><p>Maximum WASM memory</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">max_execution_time_ms</span></code></p></td>
<td><p>1000</p></td>
<td><p>Execution timeout</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">max_stack_size</span></code></p></td>
<td><p>1MB</p></td>
<td><p>Stack size limit</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">module_cache_size</span></code></p></td>
<td><p>10</p></td>
<td><p>Cached modules per worker</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Note:</strong> Rate limiting state is per-worker thread and not shared across gateway replicas. For production, consider implementing rate limiting at a shared layer (e.g., Redis)</p>
</section>
</section>
<hr class="docutils" />
<section id="language-bindings">
<h2>Language Bindings<a class="headerlink" href="#language-bindings" title="Link to this heading">#</a></h2>
<p>SGLang Model Gateway provides official language bindings for Python and Go, enabling integration with different technology stacks and organizational requirements.</p>
<section id="python-bindings">
<h3>Python Bindings<a class="headerlink" href="#python-bindings" title="Link to this heading">#</a></h3>
<p>The Python bindings provide a PyO3-based wrapper around the Rust gateway library. This is a straightforward binding that calls the gateway server startup from Python.</p>
<section id="id5">
<h4>Installation<a class="headerlink" href="#id5" title="Link to this heading">#</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># From PyPI</span>
pip<span class="w"> </span>install<span class="w"> </span>sglang-router

<span class="c1"># Development build</span>
<span class="nb">cd</span><span class="w"> </span>sgl-model-gateway/bindings/python
pip<span class="w"> </span>install<span class="w"> </span>maturin<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>maturin<span class="w"> </span>develop<span class="w"> </span>--features<span class="w"> </span>vendored-openssl
</pre></div>
</div>
</section>
<section id="id6">
<h4>Usage<a class="headerlink" href="#id6" title="Link to this heading">#</a></h4>
<p>The Python bindings are used throughout this documentation. See the <a class="reference internal" href="#quick-start"><span class="std std-ref">Quick Start</span></a> and <a class="reference internal" href="#deployment-modes"><span class="std std-ref">Deployment Modes</span></a> sections for detailed examples.</p>
<p>Key components:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RouterArgs</span></code> dataclass with 50+ configuration options</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Router.from_args()</span></code> for programmatic startup</p></li>
<li><p>CLI commands: <code class="docutils literal notranslate"><span class="pre">smg</span> <span class="pre">launch</span></code>, <code class="docutils literal notranslate"><span class="pre">smg</span> <span class="pre">server</span></code>, <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">sglang_router.launch_router</span></code></p></li>
</ul>
</section>
</section>
<section id="go-bindings">
<h3>Go Bindings<a class="headerlink" href="#go-bindings" title="Link to this heading">#</a></h3>
<p>The Go bindings provide a high-performance gRPC client library for organizations with Go-based infrastructure. This is ideal for:</p>
<ul class="simple">
<li><p>Integration with internal Go services and tooling</p></li>
<li><p>High-performance client applications</p></li>
<li><p>Building custom OpenAI-compatible proxy servers</p></li>
</ul>
<section id="id7">
<h4>Architecture<a class="headerlink" href="#id7" title="Link to this heading">#</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
         High-Level Go API               
   (client.go - OpenAI-style interface)  

         gRPC Layer                      

         Rust FFI Layer                  
   (Tokenization, Parsing, Conversion)   

</pre></div>
</div>
<p><strong>Key Features:</strong></p>
<ul class="simple">
<li><p>Native Rust tokenization via FFI (thread-safe, lock-free)</p></li>
<li><p>Full streaming support with context cancellation</p></li>
<li><p>Configurable channel buffer sizes for high concurrency</p></li>
<li><p>Built-in tool call parsing and chat template application</p></li>
</ul>
</section>
<section id="id8">
<h4>Installation<a class="headerlink" href="#id8" title="Link to this heading">#</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Build the FFI library first</span>
<span class="nb">cd</span><span class="w"> </span>sgl-model-gateway/bindings/golang
make<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make<span class="w"> </span>lib

<span class="c1"># Then use in your Go project</span>
go<span class="w"> </span>get<span class="w"> </span>github.com/sgl-project/sgl-go-sdk
</pre></div>
</div>
<p><strong>Requirements:</strong> Go 1.24+, Rust toolchain</p>
</section>
<section id="id9">
<h4>Examples<a class="headerlink" href="#id9" title="Link to this heading">#</a></h4>
<p>Complete working examples are available in <code class="docutils literal notranslate"><span class="pre">bindings/golang/examples/</span></code>:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Example</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">simple/</span></code></p></td>
<td><p>Non-streaming chat completion</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">streaming/</span></code></p></td>
<td><p>Streaming chat completion with SSE</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">oai_server/</span></code></p></td>
<td><p>Full OpenAI-compatible HTTP server</p></td>
</tr>
</tbody>
</table>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run examples</span>
<span class="nb">cd</span><span class="w"> </span>sgl-model-gateway/bindings/golang/examples/simple<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>./run.sh
<span class="nb">cd</span><span class="w"> </span>sgl-model-gateway/bindings/golang/examples/streaming<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>./run.sh
<span class="nb">cd</span><span class="w"> </span>sgl-model-gateway/bindings/golang/examples/oai_server<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>./run.sh
</pre></div>
</div>
</section>
<section id="testing">
<h4>Testing<a class="headerlink" href="#testing" title="Link to this heading">#</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>sgl-model-gateway/bindings/golang

<span class="c1"># Unit tests</span>
go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-v<span class="w"> </span>./...

<span class="c1"># Integration tests (requires running SGLang server)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">SGL_GRPC_ENDPOINT</span><span class="o">=</span>grpc://localhost:20000
<span class="nb">export</span><span class="w"> </span><span class="nv">SGL_TOKENIZER_PATH</span><span class="o">=</span>/path/to/tokenizer
go<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-tags<span class="o">=</span>integration<span class="w"> </span>-v<span class="w"> </span>./...
</pre></div>
</div>
</section>
</section>
<section id="comparison">
<h3>Comparison<a class="headerlink" href="#comparison" title="Link to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Feature</p></th>
<th class="head"><p>Python</p></th>
<th class="head"><p>Go</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Primary Use</strong></p></td>
<td><p>Gateway server launcher</p></td>
<td><p>gRPC client library</p></td>
</tr>
<tr class="row-odd"><td><p><strong>CLI Support</strong></p></td>
<td><p>Full CLI (smg, sglang-router)</p></td>
<td><p>Library only</p></td>
</tr>
<tr class="row-even"><td><p><strong>K8s Discovery</strong></p></td>
<td><p>Native support</p></td>
<td><p>N/A (client library)</p></td>
</tr>
<tr class="row-odd"><td><p><strong>PD Mode</strong></p></td>
<td><p>Built-in</p></td>
<td><p>N/A (client library)</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>When to Use Python:</strong> Launching and managing the gateway server, service discovery, PD disaggregation.</p>
<p><strong>When to Use Go:</strong> Building custom client applications, integration with Go microservices, OpenAI-compatible proxy servers</p>
</section>
</section>
<hr class="docutils" />
<section id="security-and-authentication">
<h2>Security and Authentication<a class="headerlink" href="#security-and-authentication" title="Link to this heading">#</a></h2>
<section id="router-api-key">
<h3>Router API Key<a class="headerlink" href="#router-api-key" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--api-key<span class="w"> </span><span class="s2">&quot;your-router-api-key&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-urls<span class="w"> </span>http://worker1:8000
</pre></div>
</div>
<p>Clients must supply <code class="docutils literal notranslate"><span class="pre">Authorization:</span> <span class="pre">Bearer</span> <span class="pre">&lt;key&gt;</span></code> for protected endpoints.</p>
</section>
<section id="worker-api-keys">
<h3>Worker API Keys<a class="headerlink" href="#worker-api-keys" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add worker with explicit key</span>
curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer router-key&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8080/workers<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;url&quot;:&quot;http://worker:8000&quot;,&quot;api_key&quot;:&quot;worker-key&quot;}&#39;</span>
</pre></div>
</div>
</section>
<section id="security-configurations">
<h3>Security Configurations<a class="headerlink" href="#security-configurations" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p><strong>No Authentication</strong> (default): Use only in trusted environments</p></li>
<li><p><strong>Router-only Authentication</strong>: Clients authenticate to router</p></li>
<li><p><strong>Worker-only Authentication</strong>: Router open, workers require keys</p></li>
<li><p><strong>Full Authentication</strong>: Both router and workers protected</p></li>
</ol>
</section>
<section id="tls-https-for-gateway-server">
<h3>TLS (HTTPS) for Gateway Server<a class="headerlink" href="#tls-https-for-gateway-server" title="Link to this heading">#</a></h3>
<p>Enable TLS to serve the gateway over HTTPS:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-urls<span class="w"> </span>http://worker1:8000<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--tls-cert-path<span class="w"> </span>/path/to/server.crt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--tls-key-path<span class="w"> </span>/path/to/server.key
</pre></div>
</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--tls-cert-path</span></code></p></td>
<td><p>Path to server certificate (PEM format)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--tls-key-path</span></code></p></td>
<td><p>Path to server private key (PEM format)</p></td>
</tr>
</tbody>
</table>
</div>
<p>Both parameters must be provided together. The gateway uses rustls with the ring crypto provider for TLS termination. If TLS is not configured, the gateway falls back to plain HTTP.</p>
</section>
<section id="mtls-for-worker-communication">
<h3>mTLS for Worker Communication<a class="headerlink" href="#mtls-for-worker-communication" title="Link to this heading">#</a></h3>
<p>Enable mutual TLS (mTLS) for secure communication with workers in HTTP mode:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-urls<span class="w"> </span>https://worker1:8443<span class="w"> </span>https://worker2:8443<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--client-cert-path<span class="w"> </span>/path/to/client.crt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--client-key-path<span class="w"> </span>/path/to/client.key<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--ca-cert-path<span class="w"> </span>/path/to/ca.crt
</pre></div>
</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--client-cert-path</span></code></p></td>
<td><p>Path to client certificate for mTLS (PEM format)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--client-key-path</span></code></p></td>
<td><p>Path to client private key for mTLS (PEM format)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--ca-cert-path</span></code></p></td>
<td><p>Path to CA certificate for verifying worker TLS (PEM format, repeatable)</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Key Points:</strong></p>
<ul class="simple">
<li><p>Client certificate and key must be provided together</p></li>
<li><p>Multiple CA certificates can be added with multiple <code class="docutils literal notranslate"><span class="pre">--ca-cert-path</span></code> flags</p></li>
<li><p>Uses rustls backend when TLS is configured</p></li>
<li><p>Single HTTP client is created for all workers (assumes single security domain)</p></li>
<li><p>TCP keepalive (30 seconds) is enabled for long-lived connections</p></li>
</ul>
</section>
<section id="full-tls-configuration-example">
<h3>Full TLS Configuration Example<a class="headerlink" href="#full-tls-configuration-example" title="Link to this heading">#</a></h3>
<p>Gateway HTTPS + Worker mTLS + API Key authentication:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-urls<span class="w"> </span>https://worker1:8443<span class="w"> </span>https://worker2:8443<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--tls-cert-path<span class="w"> </span>/etc/certs/server.crt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--tls-key-path<span class="w"> </span>/etc/certs/server.key<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--client-cert-path<span class="w"> </span>/etc/certs/client.crt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--client-key-path<span class="w"> </span>/etc/certs/client.key<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--ca-cert-path<span class="w"> </span>/etc/certs/ca.crt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--api-key<span class="w"> </span><span class="s2">&quot;secure-api-key&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--policy<span class="w"> </span>cache_aware
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="observability">
<h2>Observability<a class="headerlink" href="#observability" title="Link to this heading">#</a></h2>
<section id="prometheus-metrics">
<h3>Prometheus Metrics<a class="headerlink" href="#prometheus-metrics" title="Link to this heading">#</a></h3>
<p>Enable with <code class="docutils literal notranslate"><span class="pre">--prometheus-host</span></code>/<code class="docutils literal notranslate"><span class="pre">--prometheus-port</span></code> (defaults to <code class="docutils literal notranslate"><span class="pre">0.0.0.0:29000</span></code>).</p>
<section id="metric-categories-40-metrics">
<h4>Metric Categories (40+ metrics)<a class="headerlink" href="#metric-categories-40-metrics" title="Link to this heading">#</a></h4>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Layer</p></th>
<th class="head"><p>Prefix</p></th>
<th class="head"><p>Metrics</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>HTTP</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">smg_http_*</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">requests_total</span></code>, <code class="docutils literal notranslate"><span class="pre">request_duration_seconds</span></code>, <code class="docutils literal notranslate"><span class="pre">responses_total</span></code>, <code class="docutils literal notranslate"><span class="pre">connections_active</span></code>, <code class="docutils literal notranslate"><span class="pre">rate_limit_total</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Router</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">smg_router_*</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">requests_total</span></code>, <code class="docutils literal notranslate"><span class="pre">request_duration_seconds</span></code>, <code class="docutils literal notranslate"><span class="pre">request_errors_total</span></code>, <code class="docutils literal notranslate"><span class="pre">stage_duration_seconds</span></code>, <code class="docutils literal notranslate"><span class="pre">upstream_responses_total</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Inference</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">smg_router_*</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ttft_seconds</span></code>, <code class="docutils literal notranslate"><span class="pre">tpot_seconds</span></code>, <code class="docutils literal notranslate"><span class="pre">tokens_total</span></code>, <code class="docutils literal notranslate"><span class="pre">generation_duration_seconds</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Worker</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">smg_worker_*</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">pool_size</span></code>, <code class="docutils literal notranslate"><span class="pre">connections_active</span></code>, <code class="docutils literal notranslate"><span class="pre">requests_active</span></code>, <code class="docutils literal notranslate"><span class="pre">health_checks_total</span></code>, <code class="docutils literal notranslate"><span class="pre">selection_total</span></code>, <code class="docutils literal notranslate"><span class="pre">errors_total</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Circuit Breaker</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">smg_worker_cb_*</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">state</span></code>, <code class="docutils literal notranslate"><span class="pre">transitions_total</span></code>, <code class="docutils literal notranslate"><span class="pre">outcomes_total</span></code>, <code class="docutils literal notranslate"><span class="pre">consecutive_failures</span></code>, <code class="docutils literal notranslate"><span class="pre">consecutive_successes</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Retry</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">smg_worker_*</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">retries_total</span></code>, <code class="docutils literal notranslate"><span class="pre">retries_exhausted_total</span></code>, <code class="docutils literal notranslate"><span class="pre">retry_backoff_seconds</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Discovery</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">smg_discovery_*</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">registrations_total</span></code>, <code class="docutils literal notranslate"><span class="pre">deregistrations_total</span></code>, <code class="docutils literal notranslate"><span class="pre">sync_duration_seconds</span></code>, <code class="docutils literal notranslate"><span class="pre">workers_discovered</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>MCP</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">smg_mcp_*</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">tool_calls_total</span></code>, <code class="docutils literal notranslate"><span class="pre">tool_duration_seconds</span></code>, <code class="docutils literal notranslate"><span class="pre">servers_active</span></code>, <code class="docutils literal notranslate"><span class="pre">tool_iterations_total</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Database</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">smg_db_*</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">operations_total</span></code>, <code class="docutils literal notranslate"><span class="pre">operation_duration_seconds</span></code>, <code class="docutils literal notranslate"><span class="pre">connections_active</span></code>, <code class="docutils literal notranslate"><span class="pre">items_stored</span></code></p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="key-inference-metrics-grpc-mode">
<h4>Key Inference Metrics (gRPC mode)<a class="headerlink" href="#key-inference-metrics-grpc-mode" title="Link to this heading">#</a></h4>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Metric</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">smg_router_ttft_seconds</span></code></p></td>
<td><p>Histogram</p></td>
<td><p>Time to first token</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">smg_router_tpot_seconds</span></code></p></td>
<td><p>Histogram</p></td>
<td><p>Time per output token</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">smg_router_tokens_total</span></code></p></td>
<td><p>Counter</p></td>
<td><p>Total tokens (input/output)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">smg_router_generation_duration_seconds</span></code></p></td>
<td><p>Histogram</p></td>
<td><p>End-to-end generation time</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="duration-buckets">
<h4>Duration Buckets<a class="headerlink" href="#duration-buckets" title="Link to this heading">#</a></h4>
<p>1ms, 5ms, 10ms, 25ms, 50ms, 100ms, 250ms, 500ms, 1s, 2.5s, 5s, 10s, 15s, 30s, 45s, 60s, 90s, 120s, 180s, 240s</p>
</section>
</section>
<section id="opentelemetry-tracing">
<h3>OpenTelemetry Tracing<a class="headerlink" href="#opentelemetry-tracing" title="Link to this heading">#</a></h3>
<p>Enable distributed tracing with OTLP export:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-urls<span class="w"> </span>http://worker1:8000<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--enable-trace<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--otlp-traces-endpoint<span class="w"> </span>localhost:4317
</pre></div>
</div>
<section id="features">
<h4>Features<a class="headerlink" href="#features" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>OTLP/gRPC exporter (default port 4317)</p></li>
<li><p>W3C Trace Context propagation for HTTP and gRPC</p></li>
<li><p>Batch span processing (500ms delay, 64 span batch size)</p></li>
<li><p>Custom filtering to reduce noise</p></li>
<li><p>Trace context injection into upstream worker requests</p></li>
<li><p>Service name: <code class="docutils literal notranslate"><span class="pre">sgl-router</span></code></p></li>
</ul>
</section>
</section>
<section id="logging">
<h3>Logging<a class="headerlink" href="#logging" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-urls<span class="w"> </span>http://worker1:8000<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--log-level<span class="w"> </span>debug<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--log-dir<span class="w"> </span>./router_logs
</pre></div>
</div>
<p>Structured tracing with optional file sink. Log levels: <code class="docutils literal notranslate"><span class="pre">debug</span></code>, <code class="docutils literal notranslate"><span class="pre">info</span></code>, <code class="docutils literal notranslate"><span class="pre">warn</span></code>, <code class="docutils literal notranslate"><span class="pre">error</span></code>.</p>
</section>
<section id="request-id-propagation">
<h3>Request ID Propagation<a class="headerlink" href="#request-id-propagation" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--request-id-headers<span class="w"> </span>x-request-id<span class="w"> </span>x-trace-id<span class="w"> </span>x-correlation-id
</pre></div>
</div>
<p>Responses include <code class="docutils literal notranslate"><span class="pre">x-request-id</span></code> header for correlation.</p>
</section>
</section>
<hr class="docutils" />
<section id="production-recommendations">
<h2>Production Recommendations<a class="headerlink" href="#production-recommendations" title="Link to this heading">#</a></h2>
<p>This section provides guidance for deploying SGLang Model Gateway in production environments.</p>
<section id="security-best-practices">
<h3>Security Best Practices<a class="headerlink" href="#security-best-practices" title="Link to this heading">#</a></h3>
<p><strong>Always enable TLS in production:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-urls<span class="w"> </span>https://worker1:8443<span class="w"> </span>https://worker2:8443<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--tls-cert-path<span class="w"> </span>/etc/certs/server.crt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--tls-key-path<span class="w"> </span>/etc/certs/server.key<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--client-cert-path<span class="w"> </span>/etc/certs/client.crt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--client-key-path<span class="w"> </span>/etc/certs/client.key<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--ca-cert-path<span class="w"> </span>/etc/certs/ca.crt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--api-key<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">ROUTER_API_KEY</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p><strong>Security Checklist:</strong></p>
<ul class="simple">
<li><p>Enable TLS for gateway HTTPS termination</p></li>
<li><p>Enable mTLS for worker communication when workers are on untrusted networks</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">--api-key</span></code> to protect router endpoints</p></li>
<li><p>Use Kubernetes Secrets or a secrets manager for credentials</p></li>
<li><p>Rotate certificates and API keys periodically</p></li>
<li><p>Restrict network access with firewalls or network policies</p></li>
</ul>
</section>
<section id="high-availability">
<h3>High Availability<a class="headerlink" href="#high-availability" title="Link to this heading">#</a></h3>
<p><strong>Scaling Strategy:</strong></p>
<p>The gateway supports running multiple replicas behind a load balancer for high availability. However, there are important considerations:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Component</p></th>
<th class="head"><p>Shared Across Replicas</p></th>
<th class="head"><p>Impact</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Worker Registry</p></td>
<td><p>No (independent)</p></td>
<td><p>Each replica discovers workers independently</p></td>
</tr>
<tr class="row-odd"><td><p>Radix Cache Tree</p></td>
<td><p>No (independent)</p></td>
<td><p>Cache hits may decrease by 10-20%</p></td>
</tr>
<tr class="row-even"><td><p>Circuit Breaker State</p></td>
<td><p>No (independent)</p></td>
<td><p>Each replica tracks failures independently</p></td>
</tr>
<tr class="row-odd"><td><p>Rate Limiting</p></td>
<td><p>No (independent)</p></td>
<td><p>Limits apply per-replica, not globally</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Recommendations:</strong></p>
<ol class="arabic">
<li><p><strong>Prefer horizontal scaling over vertical scaling</strong>: Deploy multiple smaller gateway replicas rather than one large instance with excessive CPU and memory. This provides:</p>
<ul class="simple">
<li><p>Better fault tolerance (single replica failure doesnt take down the gateway)</p></li>
<li><p>More predictable resource usage</p></li>
<li><p>Easier capacity planning</p></li>
</ul>
</li>
<li><p><strong>Use Kubernetes Service Discovery</strong>: Let the gateway automatically discover and manage workers:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--service-discovery<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--selector<span class="w"> </span><span class="nv">app</span><span class="o">=</span>sglang-worker<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--service-discovery-namespace<span class="w"> </span>production
</pre></div>
</div>
</li>
<li><p><strong>Accept cache efficiency trade-off</strong>: With multiple replicas, the cache-aware routing policys radix tree is not synchronized across replicas. This means:</p>
<ul class="simple">
<li><p>Each replica builds its own cache tree</p></li>
<li><p>Requests from the same user may hit different replicas</p></li>
<li><p>Expected cache hit rate reduction: <strong>10-20%</strong></p></li>
<li><p>This is often acceptable given the HA benefits</p></li>
</ul>
</li>
<li><p><strong>Configure session affinity (optional)</strong>: If cache efficiency is critical, configure your load balancer for session affinity based on a consistent hash of the request (e.g., user ID or API key).</p></li>
</ol>
<p><strong>Example HA Architecture:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                    
                      Load Balancer  
                       (L4/L7)       
                    
              
                                          
            
          Gateway      Gateway      Gateway  
         Replica 1    Replica 2    Replica 3 
            
                                          
              
                             
              
                                          
            
          Worker       Worker       Worker   
          Pod 1        Pod 2        Pod N    
            
</pre></div>
</div>
</section>
<section id="performance">
<h3>Performance<a class="headerlink" href="#performance" title="Link to this heading">#</a></h3>
<p><strong>Use gRPC mode for high throughput:</strong></p>
<p>gRPC mode provides the highest performance for SGLang workers:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start workers in gRPC mode</span>
python<span class="w"> </span>-m<span class="w"> </span>sglang.launch_server<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--model<span class="w"> </span>meta-llama/Llama-3.1-8B-Instruct<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--grpc-mode<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--port<span class="w"> </span><span class="m">20000</span>

<span class="c1"># Configure gateway for gRPC</span>
python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-urls<span class="w"> </span>grpc://worker1:20000<span class="w"> </span>grpc://worker2:20000<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--model-path<span class="w"> </span>meta-llama/Llama-3.1-8B-Instruct<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--policy<span class="w"> </span>cache_aware
</pre></div>
</div>
<p><strong>Performance Benefits of gRPC:</strong></p>
<ul class="simple">
<li><p>Native Rust tokenization (no Python overhead)</p></li>
<li><p>Streaming with lower latency</p></li>
<li><p>Built-in reasoning parser execution</p></li>
<li><p>Tool call parsing in the gateway</p></li>
<li><p>Reduced serialization overhead</p></li>
</ul>
<p><strong>Tuning Recommendations:</strong></p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Recommendation</p></th>
<th class="head"><p>Reason</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--policy</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">cache_aware</span></code></p></td>
<td><p>Best for repeated prompts, ~30% latency reduction</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--max-concurrent-requests</span></code></p></td>
<td><p>2-4x worker count</p></td>
<td><p>Prevent overload while maximizing throughput</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--queue-size</span></code></p></td>
<td><p>2x max-concurrent</p></td>
<td><p>Buffer for burst traffic</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--request-timeout-secs</span></code></p></td>
<td><p>Based on max generation length</p></td>
<td><p>Prevent stuck requests</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="kubernetes-deployment">
<h3>Kubernetes Deployment<a class="headerlink" href="#kubernetes-deployment" title="Link to this heading">#</a></h3>
<p><strong>Pod Labeling for Service Discovery:</strong></p>
<p>For the gateway to discover workers automatically, label your worker pods consistently:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Worker Deployment (Regular Mode)</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sglang-worker</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sglang-worker</span>
<span class="w">      </span><span class="nt">component</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">inference</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sglang-worker</span>
<span class="w">        </span><span class="nt">component</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">inference</span>
<span class="w">        </span><span class="nt">model</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">llama-3-8b</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">worker</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lmsysorg/sglang:latest</span>
<span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8000</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20000</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grpc</span>
</pre></div>
</div>
<p><strong>Gateway configuration for discovery:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--service-discovery<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--selector<span class="w"> </span><span class="nv">app</span><span class="o">=</span>sglang-worker<span class="w"> </span><span class="nv">component</span><span class="o">=</span>inference<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--service-discovery-namespace<span class="w"> </span>production<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--service-discovery-port<span class="w"> </span><span class="m">8000</span>
</pre></div>
</div>
<p><strong>PD (Prefill/Decode) Mode Labeling:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prefill Worker</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sglang-worker</span>
<span class="w">    </span><span class="nt">component</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prefill</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">sglang.ai/bootstrap-port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;9001&quot;</span>

<span class="c1"># Decode Worker</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sglang-worker</span>
<span class="w">    </span><span class="nt">component</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">decode</span>
</pre></div>
</div>
<p><strong>Gateway configuration for PD discovery:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--service-discovery<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--pd-disaggregation<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--prefill-selector<span class="w"> </span><span class="nv">app</span><span class="o">=</span>sglang-worker<span class="w"> </span><span class="nv">component</span><span class="o">=</span>prefill<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--decode-selector<span class="w"> </span><span class="nv">app</span><span class="o">=</span>sglang-worker<span class="w"> </span><span class="nv">component</span><span class="o">=</span>decode<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--service-discovery-namespace<span class="w"> </span>production
</pre></div>
</div>
<p><strong>RBAC Requirements:</strong></p>
<p>The gateway needs permissions to watch pods:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Role</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sglang-gateway</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;pods&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;watch&quot;</span><span class="p p-Indicator">]</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RoleBinding</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sglang-gateway</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="nt">subjects</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sglang-gateway</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="nt">roleRef</span><span class="p">:</span>
<span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Role</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sglang-gateway</span>
<span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
</pre></div>
</div>
</section>
<section id="monitoring-with-promql">
<h3>Monitoring with PromQL<a class="headerlink" href="#monitoring-with-promql" title="Link to this heading">#</a></h3>
<p>Configure Prometheus to scrape the gateway metrics endpoint (default: <code class="docutils literal notranslate"><span class="pre">:29000/metrics</span></code>).</p>
<p><strong>Essential Dashboards:</strong></p>
<p><strong>1. Request Rate and Latency:</strong></p>
<div class="highlight-promql notranslate"><div class="highlight"><pre><span></span><span class="c1"># Request rate by endpoint</span>
<span class="k">sum</span><span class="o">(</span><span class="kr">rate</span><span class="o">(</span><span class="nv">smg_http_requests_total</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">))</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="nv">path</span><span class="p">,</span><span class="w"> </span><span class="nv">method</span><span class="o">)</span>

<span class="c1"># P50 latency</span>
<span class="kr">histogram_quantile</span><span class="o">(</span><span class="mf">0.50</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="o">(</span><span class="kr">rate</span><span class="o">(</span><span class="nv">smg_http_request_duration_seconds_bucket</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">))</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="nv">le</span><span class="o">))</span>

<span class="c1"># P99 latency</span>
<span class="kr">histogram_quantile</span><span class="o">(</span><span class="mf">0.99</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="o">(</span><span class="kr">rate</span><span class="o">(</span><span class="nv">smg_http_request_duration_seconds_bucket</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">))</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="nv">le</span><span class="o">))</span>

<span class="c1"># Error rate</span>
<span class="k">sum</span><span class="o">(</span><span class="kr">rate</span><span class="o">(</span><span class="nv">smg_http_responses_total</span><span class="p">{</span><span class="nl">status</span><span class="o">=~</span><span class="p">&quot;</span><span class="s">5..</span><span class="p">&quot;}[</span><span class="s">5m</span><span class="p">]</span><span class="o">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">sum</span><span class="o">(</span><span class="kr">rate</span><span class="o">(</span><span class="nv">smg_http_responses_total</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">))</span>
</pre></div>
</div>
<p><strong>2. Worker Health:</strong></p>
<div class="highlight-promql notranslate"><div class="highlight"><pre><span></span><span class="c1"># Healthy workers</span>
<span class="k">sum</span><span class="o">(</span><span class="nv">smg_worker_pool_size</span><span class="o">)</span>

<span class="c1"># Active connections per worker</span>
<span class="nv">smg_worker_connections_active</span>

<span class="c1"># Worker health check failures</span>
<span class="k">sum</span><span class="o">(</span><span class="kr">rate</span><span class="o">(</span><span class="nv">smg_worker_health_checks_total</span><span class="p">{</span><span class="nl">result</span><span class="o">=</span><span class="p">&quot;</span><span class="s">failure</span><span class="p">&quot;}[</span><span class="s">5m</span><span class="p">]</span><span class="o">))</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="nv">worker_id</span><span class="o">)</span>
</pre></div>
</div>
<p><strong>3. Circuit Breaker Status:</strong></p>
<div class="highlight-promql notranslate"><div class="highlight"><pre><span></span><span class="c1"># Circuit breaker states (0=closed, 1=open, 2=half-open)</span>
<span class="nv">smg_worker_cb_state</span>

<span class="c1"># Circuit breaker transitions</span>
<span class="k">sum</span><span class="o">(</span><span class="kr">rate</span><span class="o">(</span><span class="nv">smg_worker_cb_transitions_total</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">))</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="nv">worker_id</span><span class="p">,</span><span class="w"> </span><span class="nv">from_state</span><span class="p">,</span><span class="w"> </span><span class="nv">to_state</span><span class="o">)</span>

<span class="c1"># Workers with open circuits</span>
<span class="k">count</span><span class="o">(</span><span class="nv">smg_worker_cb_state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="o">)</span>
</pre></div>
</div>
<p><strong>4. Inference Performance (gRPC mode):</strong></p>
<div class="highlight-promql notranslate"><div class="highlight"><pre><span></span><span class="c1"># Time to first token (P50)</span>
<span class="kr">histogram_quantile</span><span class="o">(</span><span class="mf">0.50</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="o">(</span><span class="kr">rate</span><span class="o">(</span><span class="nv">smg_router_ttft_seconds_bucket</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">))</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="nv">le</span><span class="p">,</span><span class="w"> </span><span class="nv">model</span><span class="o">))</span>

<span class="c1"># Time per output token (P99)</span>
<span class="kr">histogram_quantile</span><span class="o">(</span><span class="mf">0.99</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="o">(</span><span class="kr">rate</span><span class="o">(</span><span class="nv">smg_router_tpot_seconds_bucket</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">))</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="nv">le</span><span class="p">,</span><span class="w"> </span><span class="nv">model</span><span class="o">))</span>

<span class="c1"># Token throughput</span>
<span class="k">sum</span><span class="o">(</span><span class="kr">rate</span><span class="o">(</span><span class="nv">smg_router_tokens_total</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">))</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="nv">model</span><span class="p">,</span><span class="w"> </span><span class="nv">direction</span><span class="o">)</span>

<span class="c1"># Generation duration P95</span>
<span class="kr">histogram_quantile</span><span class="o">(</span><span class="mf">0.95</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="o">(</span><span class="kr">rate</span><span class="o">(</span><span class="nv">smg_router_generation_duration_seconds_bucket</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">))</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="nv">le</span><span class="o">))</span>
</pre></div>
</div>
<p><strong>5. Rate Limiting and Queuing:</strong></p>
<div class="highlight-promql notranslate"><div class="highlight"><pre><span></span><span class="c1"># Rate limit rejections</span>
<span class="k">sum</span><span class="o">(</span><span class="kr">rate</span><span class="o">(</span><span class="nv">smg_http_rate_limit_total</span><span class="p">{</span><span class="nl">decision</span><span class="o">=</span><span class="p">&quot;</span><span class="s">rejected</span><span class="p">&quot;}[</span><span class="s">5m</span><span class="p">]</span><span class="o">))</span>

<span class="c1"># Queue depth (if using concurrency limiting)</span>
<span class="nv">smg_worker_requests_active</span>

<span class="c1"># Retry attempts</span>
<span class="k">sum</span><span class="o">(</span><span class="kr">rate</span><span class="o">(</span><span class="nv">smg_worker_retries_total</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">))</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="nv">worker_id</span><span class="o">)</span>

<span class="c1"># Exhausted retries (failures after all retries)</span>
<span class="k">sum</span><span class="o">(</span><span class="kr">rate</span><span class="o">(</span><span class="nv">smg_worker_retries_exhausted_total</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">))</span>
</pre></div>
</div>
<p><strong>6. MCP Tool Execution:</strong></p>
<div class="highlight-promql notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tool call rate</span>
<span class="k">sum</span><span class="o">(</span><span class="kr">rate</span><span class="o">(</span><span class="nv">smg_mcp_tool_calls_total</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">))</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="nv">server</span><span class="p">,</span><span class="w"> </span><span class="nv">tool</span><span class="o">)</span>

<span class="c1"># Tool latency P95</span>
<span class="kr">histogram_quantile</span><span class="o">(</span><span class="mf">0.95</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="o">(</span><span class="kr">rate</span><span class="o">(</span><span class="nv">smg_mcp_tool_duration_seconds_bucket</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">))</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="o">(</span><span class="nv">le</span><span class="p">,</span><span class="w"> </span><span class="nv">tool</span><span class="o">))</span>

<span class="c1"># Active MCP server connections</span>
<span class="nv">smg_mcp_servers_active</span>
</pre></div>
</div>
<p><strong>Alerting Rules Example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">groups</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sglang-gateway</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HighErrorRate</span>
<span class="w">    </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">sum(rate(smg_http_responses_total{status=~&quot;5..&quot;}[5m]))</span>
<span class="w">      </span><span class="no">/ sum(rate(smg_http_responses_total[5m])) &gt; 0.05</span>
<span class="w">    </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<span class="w">    </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">      </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;High</span><span class="nv"> </span><span class="s">error</span><span class="nv"> </span><span class="s">rate</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">SGLang</span><span class="nv"> </span><span class="s">Gateway&quot;</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CircuitBreakerOpen</span>
<span class="w">    </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">count(smg_worker_cb_state == 1) &gt; 0</span>
<span class="w">    </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2m</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<span class="w">    </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">      </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Worker</span><span class="nv"> </span><span class="s">circuit</span><span class="nv"> </span><span class="s">breaker</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">open&quot;</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HighLatency</span>
<span class="w">    </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">histogram_quantile(0.99, sum(rate(smg_http_request_duration_seconds_bucket[5m])) by (le)) &gt; 30</span>
<span class="w">    </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warning</span>
<span class="w">    </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">      </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;P99</span><span class="nv"> </span><span class="s">latency</span><span class="nv"> </span><span class="s">exceeds</span><span class="nv"> </span><span class="s">30</span><span class="nv"> </span><span class="s">seconds&quot;</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NoHealthyWorkers</span>
<span class="w">    </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sum(smg_worker_pool_size) == 0</span>
<span class="w">    </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1m</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">critical</span>
<span class="w">    </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">      </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;No</span><span class="nv"> </span><span class="s">healthy</span><span class="nv"> </span><span class="s">workers</span><span class="nv"> </span><span class="s">available&quot;</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="configuration-reference">
<h2>Configuration Reference<a class="headerlink" href="#configuration-reference" title="Link to this heading">#</a></h2>
<section id="core-settings">
<h3>Core Settings<a class="headerlink" href="#core-settings" title="Link to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--host</span></code></p></td>
<td><p>str</p></td>
<td><p>127.0.0.1</p></td>
<td><p>Router host</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--port</span></code></p></td>
<td><p>int</p></td>
<td><p>30000</p></td>
<td><p>Router port</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--worker-urls</span></code></p></td>
<td><p>list</p></td>
<td><p>[]</p></td>
<td><p>Worker URLs (HTTP or gRPC)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--policy</span></code></p></td>
<td><p>str</p></td>
<td><p>cache_aware</p></td>
<td><p>Routing policy</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--max-concurrent-requests</span></code></p></td>
<td><p>int</p></td>
<td><p>-1</p></td>
<td><p>Concurrency limit (-1 disables)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--request-timeout-secs</span></code></p></td>
<td><p>int</p></td>
<td><p>600</p></td>
<td><p>Request timeout</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--max-payload-size</span></code></p></td>
<td><p>int</p></td>
<td><p>256MB</p></td>
<td><p>Maximum request payload</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="prefill-decode">
<h3>Prefill/Decode<a class="headerlink" href="#prefill-decode" title="Link to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--pd-disaggregation</span></code></p></td>
<td><p>flag</p></td>
<td><p>false</p></td>
<td><p>Enable PD mode</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--prefill</span></code></p></td>
<td><p>list</p></td>
<td><p>[]</p></td>
<td><p>Prefill URLs + optional bootstrap ports</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--decode</span></code></p></td>
<td><p>list</p></td>
<td><p>[]</p></td>
<td><p>Decode URLs</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--prefill-policy</span></code></p></td>
<td><p>str</p></td>
<td><p>None</p></td>
<td><p>Override policy for prefill nodes</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--decode-policy</span></code></p></td>
<td><p>str</p></td>
<td><p>None</p></td>
<td><p>Override policy for decode nodes</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--worker-startup-timeout-secs</span></code></p></td>
<td><p>int</p></td>
<td><p>600</p></td>
<td><p>Worker init timeout</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="kubernetes-discovery">
<h3>Kubernetes Discovery<a class="headerlink" href="#kubernetes-discovery" title="Link to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--service-discovery</span></code></p></td>
<td><p>flag</p></td>
<td><p>Enable discovery</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--selector</span></code></p></td>
<td><p>list</p></td>
<td><p>Label selectors (key=value)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--prefill-selector</span></code> / <code class="docutils literal notranslate"><span class="pre">--decode-selector</span></code></p></td>
<td><p>list</p></td>
<td><p>PD mode selectors</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--service-discovery-namespace</span></code></p></td>
<td><p>str</p></td>
<td><p>Namespace to watch</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--service-discovery-port</span></code></p></td>
<td><p>int</p></td>
<td><p>Worker port (default 80)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--bootstrap-port-annotation</span></code></p></td>
<td><p>str</p></td>
<td><p>Annotation for bootstrap ports</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="tls-configuration">
<h3>TLS Configuration<a class="headerlink" href="#tls-configuration" title="Link to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--tls-cert-path</span></code></p></td>
<td><p>str</p></td>
<td><p>Server certificate for gateway HTTPS (PEM)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--tls-key-path</span></code></p></td>
<td><p>str</p></td>
<td><p>Server private key for gateway HTTPS (PEM)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--client-cert-path</span></code></p></td>
<td><p>str</p></td>
<td><p>Client certificate for worker mTLS (PEM)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--client-key-path</span></code></p></td>
<td><p>str</p></td>
<td><p>Client private key for worker mTLS (PEM)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--ca-cert-path</span></code></p></td>
<td><p>str</p></td>
<td><p>CA certificate for verifying workers (PEM, repeatable)</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<hr class="docutils" />
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading">#</a></h2>
<section id="workers-never-ready">
<h3>Workers Never Ready<a class="headerlink" href="#workers-never-ready" title="Link to this heading">#</a></h3>
<p>Increase <code class="docutils literal notranslate"><span class="pre">--worker-startup-timeout-secs</span></code> or ensure health probes respond before router startup.</p>
</section>
<section id="load-imbalance-hot-workers">
<h3>Load Imbalance / Hot Workers<a class="headerlink" href="#load-imbalance-hot-workers" title="Link to this heading">#</a></h3>
<p>Inspect <code class="docutils literal notranslate"><span class="pre">smg_router_requests_total</span></code> by worker and tune cache-aware thresholds (<code class="docutils literal notranslate"><span class="pre">--balance-*</span></code>, <code class="docutils literal notranslate"><span class="pre">--cache-threshold</span></code>).</p>
</section>
<section id="circuit-breaker-flapping">
<h3>Circuit Breaker Flapping<a class="headerlink" href="#circuit-breaker-flapping" title="Link to this heading">#</a></h3>
<p>Increase <code class="docutils literal notranslate"><span class="pre">--cb-failure-threshold</span></code> or extend the timeout/window durations. Consider temporarily disabling retries.</p>
</section>
<section id="queue-overflow-429">
<h3>Queue Overflow (429)<a class="headerlink" href="#queue-overflow-429" title="Link to this heading">#</a></h3>
<p>Increase <code class="docutils literal notranslate"><span class="pre">--queue-size</span></code> or reduce client concurrency. Ensure <code class="docutils literal notranslate"><span class="pre">--max-concurrent-requests</span></code> matches downstream capacity.</p>
</section>
<section id="memory-growth">
<h3>Memory Growth<a class="headerlink" href="#memory-growth" title="Link to this heading">#</a></h3>
<p>Reduce <code class="docutils literal notranslate"><span class="pre">--max-tree-size</span></code> or lower <code class="docutils literal notranslate"><span class="pre">--eviction-interval-secs</span></code> for more aggressive cache pruning.</p>
</section>
<section id="debugging">
<h3>Debugging<a class="headerlink" href="#debugging" title="Link to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>sglang_router.launch_router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--worker-urls<span class="w"> </span>http://worker1:8000<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--log-level<span class="w"> </span>debug<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--log-dir<span class="w"> </span>./router_logs
</pre></div>
</div>
</section>
<section id="grpc-connection-issues">
<h3>gRPC Connection Issues<a class="headerlink" href="#grpc-connection-issues" title="Link to this heading">#</a></h3>
<p>Ensure workers are started with <code class="docutils literal notranslate"><span class="pre">--grpc-mode</span></code> and verify <code class="docutils literal notranslate"><span class="pre">--model-path</span></code> or <code class="docutils literal notranslate"><span class="pre">--tokenizer-path</span></code> is provided to the router.</p>
</section>
<section id="tokenizer-loading-failures">
<h3>Tokenizer Loading Failures<a class="headerlink" href="#tokenizer-loading-failures" title="Link to this heading">#</a></h3>
<p>Check HuggingFace Hub credentials (<code class="docutils literal notranslate"><span class="pre">HF_TOKEN</span></code> environment variable) for private models. Verify local paths are accessible.</p>
<hr class="docutils" />
<p>SGLang Model Gateway continues to evolve alongside the SGLang runtime. Keep CLI flags, integrations, and documentation aligned when adopting new features or contributing improvements.</p>
</section>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="cuda_graph_for_multi_modal_encoder.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Cuda Graph for Multi-Modal Encoder in SGLang</p>
      </div>
    </a>
    <a class="right-next"
       href="deterministic_inference.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Deterministic Inference</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#architecture">Architecture</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#control-plane">Control Plane</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-plane">Data Plane</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#storage-and-privacy">Storage and Privacy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation">Installation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#docker">Docker</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">Prerequisites</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rust-binary">Rust Binary</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#python-package">Python Package</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quick-start">Quick Start</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regular-http-routing">Regular HTTP Routing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grpc-routing">gRPC Routing</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#deployment-modes">Deployment Modes</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#co-launch-router-and-workers">Co-launch Router and Workers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#separate-launch-http">Separate Launch (HTTP)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grpc-launch">gRPC Launch</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prefill-decode-disaggregation">Prefill-Decode Disaggregation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#openai-backend-proxy">OpenAI Backend Proxy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-model-inference-gateway">Multi-Model Inference Gateway</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#api-reference">API Reference</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inference-endpoints">Inference Endpoints</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tokenization-endpoints">Tokenization Endpoints</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#tokenize-request">Tokenize Request</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#batch-tokenize-request">Batch Tokenize Request</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#tokenize-response">Tokenize Response</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#detokenize-request">Detokenize Request</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#detokenize-response">Detokenize Response</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#add-tokenizer-async">Add Tokenizer (Async)</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parser-endpoints">Parser Endpoints</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#separate-reasoning-request">Separate Reasoning Request</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#response">Response</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#function-call-parsing">Function Call Parsing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#classification-api">Classification API</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#request">Request</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Response</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#response-fields">Response Fields</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#notes">Notes</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conversation-and-response-apis">Conversation and Response APIs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#worker-management-apis">Worker Management APIs</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#add-worker">Add Worker</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#list-workers">List Workers</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#admin-and-health-endpoints">Admin and Health Endpoints</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-balancing-policies">Load Balancing Policies</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cache-aware-policy-tuning">Cache-Aware Policy Tuning</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reliability-and-flow-control">Reliability and Flow Control</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#retries">Retries</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#circuit-breaker">Circuit Breaker</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rate-limiting-and-queuing">Rate Limiting and Queuing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#health-checks">Health Checks</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reasoning-parser-integration">Reasoning Parser Integration</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#supported-parsers">Supported Parsers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#usage">Usage</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tool-call-parsing">Tool Call Parsing</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#supported-formats">Supported Formats</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Usage</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tokenizer-management">Tokenizer Management</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tokenizer-sources">Tokenizer Sources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration">Configuration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tokenizer-caching">Tokenizer Caching</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mcp-integration">MCP Integration</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#supported-transports">Supported Transports</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Configuration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mcp-configuration-file">MCP Configuration File</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#service-discovery-kubernetes">Service Discovery (Kubernetes)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pd-mode-discovery">PD Mode Discovery</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#history-and-data-connectors">History and Data Connectors</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#oracle-configuration">Oracle Configuration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#postgresql-configuration">PostgreSQL Configuration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#redis-configuration">Redis Configuration</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#wasm-middleware">WASM Middleware</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Overview</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#examples">Examples</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#building-modules">Building Modules</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deploying-modules">Deploying Modules</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#runtime-configuration">Runtime Configuration</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#language-bindings">Language Bindings</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#python-bindings">Python Bindings</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Installation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Usage</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#go-bindings">Go Bindings</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Architecture</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Installation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Examples</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison">Comparison</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#security-and-authentication">Security and Authentication</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#router-api-key">Router API Key</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#worker-api-keys">Worker API Keys</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#security-configurations">Security Configurations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tls-https-for-gateway-server">TLS (HTTPS) for Gateway Server</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mtls-for-worker-communication">mTLS for Worker Communication</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#full-tls-configuration-example">Full TLS Configuration Example</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#observability">Observability</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prometheus-metrics">Prometheus Metrics</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metric-categories-40-metrics">Metric Categories (40+ metrics)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#key-inference-metrics-grpc-mode">Key Inference Metrics (gRPC mode)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#duration-buckets">Duration Buckets</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#opentelemetry-tracing">OpenTelemetry Tracing</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#features">Features</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#logging">Logging</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#request-id-propagation">Request ID Propagation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#production-recommendations">Production Recommendations</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#security-best-practices">Security Best Practices</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#high-availability">High Availability</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#performance">Performance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kubernetes-deployment">Kubernetes Deployment</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#monitoring-with-promql">Monitoring with PromQL</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-reference">Configuration Reference</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#core-settings">Core Settings</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prefill-decode">Prefill/Decode</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kubernetes-discovery">Kubernetes Discovery</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tls-configuration">TLS Configuration</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#troubleshooting">Troubleshooting</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#workers-never-ready">Workers Never Ready</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-imbalance-hot-workers">Load Imbalance / Hot Workers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#circuit-breaker-flapping">Circuit Breaker Flapping</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#queue-overflow-429">Queue Overflow (429)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#memory-growth">Memory Growth</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#debugging">Debugging</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grpc-connection-issues">gRPC Connection Issues</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tokenizer-loading-failures">Tokenizer Loading Failures</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By SGLang Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
       Copyright 2023-2026, SGLang.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    <p class="last-updated">
  Last updated on Jan 23, 2026.
  <br/>
</p>
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  
    <!-- RunLLM Widget Script -->
    <script type="module" id="runllm-widget-script" src="https://widget.runllm.com" crossorigin="true" version="stable" runllm-keyboard-shortcut="Mod+j" runllm-name="SGLang Chatbot" runllm-position="BOTTOM_RIGHT" runllm-assistant-id="629" async></script>
    
</body>
</html>